import{j as b}from"./observer-B5GHaPvN.js";import{r as D}from"./index-RYns6xqu.js";import{R as ce}from"./textarea-DZOz3AQ5.js";const k=new WeakMap,R=new WeakMap,U={current:[]};let X=!1,B=0;const $=new Set,x=new Map;function fe(a){const i=Array.from(a).sort((t,e)=>t instanceof E&&t.options.deps.includes(e)?1:e instanceof E&&e.options.deps.includes(t)?-1:0);for(const t of i){if(U.current.includes(t))continue;U.current.push(t),t.recompute();const e=R.get(t);if(e)for(const s of e){const r=k.get(s);r&&fe(r)}}}function Se(a){a.listeners.forEach(i=>i({prevVal:a.prevState,currentVal:a.state}))}function Fe(a){a.listeners.forEach(i=>i({prevVal:a.prevState,currentVal:a.state}))}function he(a){if(B>0&&!x.has(a)&&x.set(a,a.prevState),$.add(a),!(B>0)&&!X)try{for(X=!0;$.size>0;){const i=Array.from($);$.clear();for(const t of i){const e=x.get(t)??t.prevState;t.prevState=e,Se(t)}for(const t of i){const e=k.get(t);e&&(U.current.push(t),fe(e))}for(const t of i){const e=k.get(t);if(e)for(const s of e)Fe(s)}}}finally{X=!1,U.current=[],x.clear()}}function _(a){B++;try{a()}finally{if(B--,B===0){const i=Array.from($)[0];i&&he(i)}}}class ee{constructor(i,t){this.listeners=new Set,this.subscribe=e=>{var s,r;this.listeners.add(e);const n=(r=(s=this.options)==null?void 0:s.onSubscribe)==null?void 0:r.call(s,e,this);return()=>{this.listeners.delete(e),n==null||n()}},this.setState=e=>{var s,r,n;this.prevState=this.state,this.state=(s=this.options)!=null&&s.updateFn?this.options.updateFn(this.prevState)(e):e(this.prevState),(n=(r=this.options)==null?void 0:r.onUpdate)==null||n.call(r),he(this)},this.prevState=i,this.state=i,this.options=t}}class E{constructor(i){this.listeners=new Set,this._subscriptions=[],this.lastSeenDepValues=[],this.getDepVals=()=>{const t=[],e=[];for(const s of this.options.deps)t.push(s.prevState),e.push(s.state);return this.lastSeenDepValues=e,{prevDepVals:t,currDepVals:e,prevVal:this.prevState??void 0}},this.recompute=()=>{var t,e;this.prevState=this.state;const{prevDepVals:s,currDepVals:r,prevVal:n}=this.getDepVals();this.state=this.options.fn({prevDepVals:s,currDepVals:r,prevVal:n}),(e=(t=this.options).onUpdate)==null||e.call(t)},this.checkIfRecalculationNeededDeeply=()=>{for(const r of this.options.deps)r instanceof E&&r.checkIfRecalculationNeededDeeply();let t=!1;const e=this.lastSeenDepValues,{currDepVals:s}=this.getDepVals();for(let r=0;r<s.length;r++)if(s[r]!==e[r]){t=!0;break}t&&this.recompute()},this.mount=()=>(this.registerOnGraph(),this.checkIfRecalculationNeededDeeply(),()=>{this.unregisterFromGraph();for(const t of this._subscriptions)t()}),this.subscribe=t=>{var e,s;this.listeners.add(t);const r=(s=(e=this.options).onSubscribe)==null?void 0:s.call(e,t,this);return()=>{this.listeners.delete(t),r==null||r()}},this.options=i,this.state=i.fn({prevDepVals:void 0,prevVal:void 0,currDepVals:this.getDepVals().currDepVals})}registerOnGraph(i=this.options.deps){for(const t of i)if(t instanceof E)t.registerOnGraph(),this.registerOnGraph(t.options.deps);else if(t instanceof ee){let e=k.get(t);e||(e=new Set,k.set(t,e)),e.add(this);let s=R.get(this);s||(s=new Set,R.set(this,s)),s.add(t)}}unregisterFromGraph(i=this.options.deps){for(const t of i)if(t instanceof E)this.unregisterFromGraph(t.options.deps);else if(t instanceof ee){const e=k.get(t);e&&e.delete(this);const s=R.get(this);s&&s.delete(t)}}}function N(a,i){return typeof a=="function"?a(i):a}function ve(a,i){return ae(i).reduce((e,s)=>{if(e===null)return null;if(typeof e<"u")return e[s]},a)}function Y(a,i,t){const e=ae(i);function s(r){if(!e.length)return N(t,r);const n=e.shift();if(typeof n=="string"||typeof n=="number"&&!Array.isArray(r))return typeof r=="object"?(r===null&&(r={}),{...r,[n]:s(r[n])}):{[n]:s()};if(Array.isArray(r)&&typeof n=="number"){const o=r.slice(0,n);return[...o.length?o:new Array(n),s(r[n]),...r.slice(n+1)]}return[...new Array(n),s()]}return s(a)}function Ae(a,i){const t=ae(i);function e(s){if(!s)return;if(t.length===1){const n=t[0];if(Array.isArray(s)&&typeof n=="number")return s.filter((c,d)=>d!==n);const{[n]:o,...u}=s;return u}const r=t.shift();if(typeof r=="string"&&typeof s=="object")return{...s,[r]:e(s[r])};if(typeof r=="number"&&Array.isArray(s)){if(r>=s.length)return s;const n=s.slice(0,r);return[...n.length?n:new Array(r),e(s[r]),...s.slice(r+1)]}throw new Error("It seems we have created an infinite loop in deleteBy. ")}return e(a)}const Ee=/^(\d*)$/gm,we=/\.(\d*)\./gm,_e=/^(\d*)\./gm,De=/\.(\d*$)/gm,Te=/\.{2,}/gm,te="__int__",P=`${te}$1`;function ae(a){if(Array.isArray(a))return[...a];if(typeof a!="string")throw new Error("Path must be a string.");return a.replaceAll("[",".").replaceAll("]","").replace(Ee,P).replace(we,`.${P}.`).replace(_e,`${P}.`).replace(De,`.${P}`).replace(Te,".").split(".").map(i=>i.indexOf(te)===0?parseInt(i.substring(te.length),10):i)}function ke(a){return!(Array.isArray(a)&&a.length===0)}function se(a,i){const{asyncDebounceMs:t}=i,{onChangeAsync:e,onBlurAsync:s,onSubmitAsync:r,onBlurAsyncDebounceMs:n,onChangeAsyncDebounceMs:o}=i.validators||{},u=t??0,c={cause:"change",validate:e,debounceMs:o??u},d={cause:"blur",validate:s,debounceMs:n??u},h={cause:"submit",validate:r,debounceMs:0},l=f=>({...f,debounceMs:0});switch(a){case"submit":return[l(c),l(d),h];case"blur":return[d];case"change":return[c];case"server":default:return[]}}function ie(a,i){const{onChange:t,onBlur:e,onSubmit:s,onMount:r}=i.validators||{},n={cause:"change",validate:t},o={cause:"blur",validate:e},u={cause:"submit",validate:s},c={cause:"mount",validate:r},d={cause:"server",validate:()=>{}};switch(a){case"mount":return[c];case"submit":return[n,o,u,d];case"server":return[d];case"blur":return[o,d];case"change":default:return[n,d]}}function Oe(a,i){const t=new Map;for(const s of a){const r=[...s.path??[]].map(n=>{const o=typeof n=="object"?n.key:n;return typeof o=="number"?`[${o}]`:o}).join(".").replace(/\.\[/g,"[");t.set(r,(t.get(r)??[]).concat(s))}const e={};return t.forEach((s,r)=>{e[r]=i(s)}),e}function Ie(a){return i=>({form:a(i),fields:Oe(i,a)})}const me=(a={})=>()=>{const i=a.transformErrors??(e=>e.map(s=>s.message).join(", ")),t=e=>e==="form"?Ie(i):i;return{validate({value:e,validationSource:s},r){const n=r["~standard"].validate(e);if(n instanceof Promise)throw new Error("async function passed to sync validator");return n.issues?t(s)(n.issues):void 0},async validateAsync({value:e,validationSource:s},r){const n=await r["~standard"].validate(e);return n.issues?t(s)(n.issues):void 0}}},pe=a=>!!a&&"~standard"in a;function Z(a){return{values:a.values??{},errorMap:a.errorMap??{},fieldMetaBase:a.fieldMetaBase??{},isSubmitted:a.isSubmitted??!1,isSubmitting:a.isSubmitting??!1,isValidating:a.isValidating??!1,submissionAttempts:a.submissionAttempts??0,validationMetaMap:a.validationMetaMap??{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0}}}const $e=a=>typeof a=="object";class Be{constructor(i){var t;this.options={},this.fieldInfo={},this.prevTransformArray=[],this.mount=()=>{const e=this.fieldMetaDerived.mount(),s=this.store.mount(),r=()=>{e(),s()},{onMount:n}=this.options.validators||{};return n&&this.validateSync("mount"),r},this.update=e=>{if(!e)return;const s=this.options;this.options=e,_(()=>{const r=e.defaultValues&&e.defaultValues!==s.defaultValues&&!this.state.isTouched,n=e.defaultState!==s.defaultState&&!this.state.isTouched;this.baseStore.setState(()=>Z(Object.assign({},this.state,n?e.defaultState:{},r?{values:e.defaultValues}:{})))})},this.reset=(e,s)=>{const{fieldMeta:r}=this.state,n=this.resetFieldMeta(r);e&&!(s!=null&&s.keepDefaultValues)&&(this.options={...this.options,defaultValues:e}),this.baseStore.setState(()=>{var o;return Z({...this.options.defaultState,values:e??this.options.defaultValues??((o=this.options.defaultState)==null?void 0:o.values),fieldMetaBase:n})})},this.validateAllFields=async e=>{const s=[];return _(()=>{Object.values(this.fieldInfo).forEach(n=>{if(!n.instance)return;const o=n.instance;s.push(Promise.resolve().then(()=>o.validate(e))),n.instance.state.meta.isTouched||n.instance.setMeta(u=>({...u,isTouched:!0}))})}),(await Promise.all(s)).flat()},this.validateArrayFieldsStartingFrom=async(e,s,r)=>{const n=this.getFieldValue(e),o=Array.isArray(n)?Math.max(n.length-1,0):null,u=[`${e}[${s}]`];for(let l=s+1;l<=(o??0);l++)u.push(`${e}[${l}]`);const c=Object.keys(this.fieldInfo).filter(l=>u.some(f=>l.startsWith(f))),d=[];return _(()=>{c.forEach(l=>{d.push(Promise.resolve().then(()=>this.validateField(l,r)))})}),(await Promise.all(d)).flat()},this.validateField=(e,s)=>{var r;const n=(r=this.fieldInfo[e])==null?void 0:r.instance;return n?(n.state.meta.isTouched||n.setMeta(o=>({...o,isTouched:!0})),n.validate(s)):[]},this.validateSync=e=>{const s=ie(e,this.options);let r=!1;const n={};_(()=>{for(const u of s){if(!u.validate)continue;const c=this.runValidator({validate:u.validate,value:{value:this.state.values,formApi:this,validationSource:"form"},type:"validate"}),{formError:d,fieldErrors:h}=re(c),l=C(u.cause);if(h)for(const[f,m]of Object.entries(h)){const M={...n[f]||{},[l]:m};n[f]=M;const g=this.getFieldMeta(f);g&&g.errorMap[l]!==m&&this.setFieldMeta(f,p=>({...p,errorMap:{...p.errorMap,[l]:m}}))}this.state.errorMap[l]!==d&&this.baseStore.setState(f=>({...f,errorMap:{...f.errorMap,[l]:d}})),(d||h)&&(r=!0)}});const o=C("submit");return this.state.errorMap[o]&&e!=="submit"&&!r&&this.baseStore.setState(u=>({...u,errorMap:{...u.errorMap,[o]:void 0}})),{hasErrored:r,fieldsErrorMap:n}},this.validateAsync=async e=>{const s=se(e,this.options);this.state.isFormValidating||this.baseStore.setState(c=>({...c,isFormValidating:!0}));const r=[];let n;for(const c of s){if(!c.validate)continue;const d=C(c.cause),h=this.state.validationMetaMap[d];h==null||h.lastAbortController.abort();const l=new AbortController;this.state.validationMetaMap[d]={lastAbortController:l},r.push(new Promise(async f=>{let m;try{m=await new Promise((p,F)=>{setTimeout(async()=>{if(l.signal.aborted)return p(void 0);try{p(await this.runValidator({validate:c.validate,value:{value:this.state.values,formApi:this,validationSource:"form",signal:l.signal},type:"validateAsync"}))}catch(A){F(A)}},c.debounceMs)})}catch(p){m=p}const{formError:y,fieldErrors:M}=re(m);M&&(n=n?{...n,...M}:M);const g=C(c.cause);if(n)for(const[p,F]of Object.entries(n)){const A=this.getFieldMeta(p);A&&A.errorMap[g]!==F&&this.setFieldMeta(p,T=>({...T,errorMap:{...T.errorMap,[g]:F}}))}this.baseStore.setState(p=>({...p,errorMap:{...p.errorMap,[g]:y}})),f(n?{fieldErrors:n,errorMapKey:g}:void 0)}))}let o=[];const u={};if(r.length){o=await Promise.all(r);for(const c of o)if(c!=null&&c.fieldErrors){const{errorMapKey:d}=c;for(const[h,l]of Object.entries(c.fieldErrors)){const m={...u[h]||{},[d]:l};u[h]=m}}}return this.baseStore.setState(c=>({...c,isFormValidating:!1})),u},this.validate=e=>{const{hasErrored:s,fieldsErrorMap:r}=this.validateSync(e);return s&&!this.options.asyncAlways?r:this.validateAsync(e)},this.handleSubmit=async()=>{var e,s,r,n;if(this.baseStore.setState(u=>({...u,isSubmitted:!1,submissionAttempts:u.submissionAttempts+1})),!this.state.canSubmit)return;this.baseStore.setState(u=>({...u,isSubmitting:!0}));const o=()=>{this.baseStore.setState(u=>({...u,isSubmitting:!1}))};if(await this.validateAllFields("submit"),!this.state.isValid){o(),(s=(e=this.options).onSubmitInvalid)==null||s.call(e,{value:this.state.values,formApi:this});return}_(()=>{Object.values(this.fieldInfo).forEach(u=>{var c,d,h;(h=(d=(c=u.instance)==null?void 0:c.options.listeners)==null?void 0:d.onSubmit)==null||h.call(d,{value:u.instance.state.value,fieldApi:u.instance})})});try{await((n=(r=this.options).onSubmit)==null?void 0:n.call(r,{value:this.state.values,formApi:this})),_(()=>{this.baseStore.setState(u=>({...u,isSubmitted:!0})),o()})}catch(u){throw o(),u}},this.getFieldValue=e=>ve(this.state.values,e),this.getFieldMeta=e=>this.state.fieldMeta[e],this.getFieldInfo=e=>{var s;return(s=this.fieldInfo)[e]||(s[e]={instance:null,validationMetaMap:{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0}})},this.setFieldMeta=(e,s)=>{this.baseStore.setState(r=>({...r,fieldMetaBase:{...r.fieldMetaBase,[e]:N(s,r.fieldMetaBase[e])}}))},this.resetFieldMeta=e=>Object.keys(e).reduce((s,r)=>{const n=r;return s[n]={isValidating:!1,isTouched:!1,isBlurred:!1,isDirty:!1,isPristine:!0,errors:[],errorMap:{}},s},{}),this.setFieldValue=(e,s,r)=>{const n=(r==null?void 0:r.dontUpdateMeta)??!1;_(()=>{n||this.setFieldMeta(e,o=>({...o,isTouched:!0,isDirty:!0,errorMap:{...o==null?void 0:o.errorMap,onMount:void 0}})),this.baseStore.setState(o=>({...o,values:Y(o.values,e,s)}))})},this.deleteField=e=>{this.baseStore.setState(s=>{const r={...s};return r.values=Ae(r.values,e),delete r.fieldMetaBase[e],r}),delete this.fieldInfo[e]},this.pushFieldValue=(e,s,r)=>{this.setFieldValue(e,n=>[...Array.isArray(n)?n:[],s],r),this.validateField(e,"change")},this.insertFieldValue=async(e,s,r,n)=>{this.setFieldValue(e,o=>[...o.slice(0,s),r,...o.slice(s)],n),await this.validateField(e,"change")},this.replaceFieldValue=async(e,s,r,n)=>{this.setFieldValue(e,o=>o.map((u,c)=>c===s?r:u),n),await this.validateField(e,"change"),await this.validateArrayFieldsStartingFrom(e,s,"change")},this.removeFieldValue=async(e,s,r)=>{const n=this.getFieldValue(e),o=Array.isArray(n)?Math.max(n.length-1,0):null;if(this.setFieldValue(e,u=>u.filter((c,d)=>d!==s),r),o!==null){const u=`${e}[${o}]`;Object.keys(this.fieldInfo).filter(d=>d.startsWith(u)).forEach(d=>this.deleteField(d))}await this.validateField(e,"change"),await this.validateArrayFieldsStartingFrom(e,s,"change")},this.swapFieldValues=(e,s,r,n)=>{this.setFieldValue(e,o=>{const u=o[s],c=o[r];return Y(Y(o,`${s}`,c),`${r}`,u)},n),this.validateField(e,"change"),this.validateField(`${e}[${s}]`,"change"),this.validateField(`${e}[${r}]`,"change")},this.moveFieldValues=(e,s,r,n)=>{this.setFieldValue(e,o=>(o.splice(r,0,o.splice(s,1)[0]),o),n),this.validateField(e,"change"),this.validateField(`${e}[${s}]`,"change"),this.validateField(`${e}[${r}]`,"change")},this.baseStore=new ee(Z({...i==null?void 0:i.defaultState,values:(i==null?void 0:i.defaultValues)??((t=i==null?void 0:i.defaultState)==null?void 0:t.values),isFormValid:!0})),this.fieldMetaDerived=new E({deps:[this.baseStore],fn:({prevDepVals:e,currDepVals:s,prevVal:r})=>{var n;const o=r,u=e==null?void 0:e[0],c=s[0],d={};for(const h of Object.keys(c.fieldMetaBase)){const l=c.fieldMetaBase[h],f=u==null?void 0:u.fieldMetaBase[h];let m=(n=o==null?void 0:o[h])==null?void 0:n.errors;(!f||l.errorMap!==f.errorMap)&&(m=Object.values(l.errorMap??{}).filter(M=>M!==void 0));const y=!l.isDirty;d[h]={...l,errors:m,isPristine:y}}return d}}),this.store=new E({deps:[this.baseStore,this.fieldMetaDerived],fn:({prevDepVals:e,currDepVals:s,prevVal:r})=>{var n,o,u,c;const d=r,h=e==null?void 0:e[0],l=s[0],f=Object.values(l.fieldMetaBase),m=f.some(v=>v==null?void 0:v.isValidating),y=!f.some(v=>(v==null?void 0:v.errorMap)&&ke(Object.values(v.errorMap).filter(Boolean))),M=f.some(v=>v==null?void 0:v.isTouched),g=f.some(v=>v==null?void 0:v.isBlurred),p=M&&((n=l==null?void 0:l.errorMap)==null?void 0:n.onMount),F=f.some(v=>v==null?void 0:v.isDirty),A=!F,T=!!((o=l.errorMap)!=null&&o.onMount||f.some(v=>{var S;return(S=v==null?void 0:v.errorMap)==null?void 0:S.onMount})),W=!!m;let w=(d==null?void 0:d.errors)??[];(!h||l.errorMap!==h.errorMap)&&(w=Object.values(l.errorMap).reduce((v,S)=>S===void 0?v:typeof S=="string"?(v.push(S),v):(S&&$e(S)&&v.push(S.form),v),[]));const V=w.length===0,j=y&&V,G=l.submissionAttempts===0&&!M&&!T||!W&&!l.isSubmitting&&j;let H=l.errorMap;p&&(w=w.filter(v=>v!==l.errorMap.onMount),H=Object.assign(H,{onMount:void 0}));let J={...l,errorMap:H,fieldMeta:this.fieldMetaDerived.state,errors:w,isFieldsValidating:m,isFieldsValid:y,isFormValid:V,isValid:j,canSubmit:G,isTouched:M,isBlurred:g,isPristine:A,isDirty:F};const Q=((u=this.options.transform)==null?void 0:u.deps)??[];if(Q.length!==this.prevTransformArray.length||Q.some((v,S)=>v!==this.prevTransformArray[S])){const v=Object.assign({},this,{state:J});(c=this.options.transform)==null||c.fn(v),J=v.state,this.prevTransformArray=Q}return J}}),this.update(i||{})}get state(){return this.store.state}runValidator(i){const t=this.options.validatorAdapter;return t&&(typeof i.validate!="function"||"~standard"in i.validate)?t()[i.type](i.value,i.validate):pe(i.validate)?me()()[i.type](i.value,i.validate):i.validate(i.value)}setErrorMap(i){this.baseStore.setState(t=>({...t,errorMap:{...t.errorMap,...i}}))}}function re(a){if(a){if(typeof a=="object"){const i=re(a.form).formError,t=a.fields;return{formError:i,fieldErrors:t}}return typeof a!="string"?{formError:"Invalid Form Values"}:{formError:a}}return{formError:void 0}}function C(a){switch(a){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"change":default:return"onChange"}}class je{constructor(i){this.options={},this.mount=()=>{var t,e;const s=this.store.mount(),r=this.getInfo();r.instance=this,this.update(this.options);const{onMount:n}=this.options.validators||{};if(n){const o=this.runValidator({validate:n,value:{value:this.state.value,fieldApi:this,validationSource:"field"},type:"validate"});o&&this.setMeta(u=>({...u,errorMap:{...u==null?void 0:u.errorMap,onMount:o}}))}return(e=(t=this.options.listeners)==null?void 0:t.onMount)==null||e.call(t,{value:this.state.value,fieldApi:this}),s},this.update=t=>{if(this.state.value===void 0){const e=ve(t.form.options.defaultValues,t.name);t.defaultValue!==void 0?this.setValue(t.defaultValue,{dontUpdateMeta:!0}):e!==void 0&&this.setValue(e,{dontUpdateMeta:!0})}this.form.getFieldMeta(this.name)===void 0&&this.setMeta(this.state.meta),this.options=t},this.getValue=()=>this.form.getFieldValue(this.name),this.setValue=(t,e)=>{var s,r;this.form.setFieldValue(this.name,t,e),(r=(s=this.options.listeners)==null?void 0:s.onChange)==null||r.call(s,{value:this.state.value,fieldApi:this}),this.validate("change")},this.getMeta=()=>this.store.state.meta,this.setMeta=t=>this.form.setFieldMeta(this.name,t),this.getInfo=()=>this.form.getFieldInfo(this.name),this.pushValue=(t,e)=>this.form.pushFieldValue(this.name,t,e),this.insertValue=(t,e,s)=>this.form.insertFieldValue(this.name,t,e,s),this.replaceValue=(t,e,s)=>this.form.replaceFieldValue(this.name,t,e,s),this.removeValue=(t,e)=>this.form.removeFieldValue(this.name,t,e),this.swapValues=(t,e,s)=>this.form.swapFieldValues(this.name,t,e,s),this.moveValue=(t,e,s)=>this.form.moveFieldValues(this.name,t,e,s),this.getLinkedFields=t=>{const e=Object.values(this.form.fieldInfo),s=[];for(const r of e){if(!r.instance)continue;const{onChangeListenTo:n,onBlurListenTo:o}=r.instance.options.validators||{};t==="change"&&(n!=null&&n.includes(this.name))&&s.push(r.instance),t==="blur"&&(o!=null&&o.includes(this.name))&&s.push(r.instance)}return s},this.validateSync=(t,e)=>{const s=ie(t,this.options),n=this.getLinkedFields(t).reduce((c,d)=>{const h=ie(t,d.options);return h.forEach(l=>{l.field=d}),c.concat(h)},[]);let o=!1;_(()=>{const c=(d,h)=>{const l=I(h.cause),f=h.validate?oe(d.runValidator({validate:h.validate,value:{value:d.store.state.value,validationSource:"field",fieldApi:d},type:"validate"})):e[l];d.state.meta.errorMap[l]!==f&&d.setMeta(m=>({...m,errorMap:{...m.errorMap,[I(h.cause)]:f||e[l]}})),(f||e[l])&&(o=!0)};for(const d of s)c(this,d);for(const d of n)d.validate&&c(d.field,d)});const u=I("submit");return this.state.meta.errorMap[u]&&t!=="submit"&&!o&&this.setMeta(c=>({...c,errorMap:{...c.errorMap,[u]:void 0}})),{hasErrored:o}},this.validateAsync=async(t,e)=>{const s=se(t,this.options),r=await e,n=this.getLinkedFields(t),o=n.reduce((l,f)=>{const m=se(t,f.options);return m.forEach(y=>{y.field=f}),l.concat(m)},[]);this.state.meta.isValidating||this.setMeta(l=>({...l,isValidating:!0}));for(const l of n)l.setMeta(f=>({...f,isValidating:!0}));const u=[],c=[],d=(l,f,m)=>{const y=I(f.cause),M=l.getInfo().validationMetaMap[y];M==null||M.lastAbortController.abort();const g=new AbortController;this.getInfo().validationMetaMap[y]={lastAbortController:g},m.push(new Promise(async p=>{var F;let A;try{A=await new Promise((V,j)=>{this.timeoutIds[f.cause]&&clearTimeout(this.timeoutIds[f.cause]),this.timeoutIds[f.cause]=setTimeout(async()=>{if(g.signal.aborted)return V(void 0);try{V(await this.runValidator({validate:f.validate,value:{value:l.store.state.value,fieldApi:l,signal:g.signal,validationSource:"field"},type:"validateAsync"}))}catch(G){j(G)}},f.debounceMs)})}catch(V){A=V}if(g.signal.aborted)return p(void 0);const T=oe(A),W=(F=r[this.name])==null?void 0:F[y],w=T||W;l.setMeta(V=>({...V,errorMap:{...V==null?void 0:V.errorMap,[y]:w}})),p(w)}))};for(const l of s)l.validate&&d(this,l,u);for(const l of o)l.validate&&d(l.field,l,c);let h=[];(u.length||c.length)&&(h=await Promise.all(u),await Promise.all(c)),this.setMeta(l=>({...l,isValidating:!1}));for(const l of n)l.setMeta(f=>({...f,isValidating:!1}));return h.filter(Boolean)},this.validate=t=>{var e;if(!this.state.meta.isTouched)return[];const{fieldsErrorMap:s}=this.form.validateSync(t),{hasErrored:r}=this.validateSync(t,s[this.name]??{});if(r&&!this.options.asyncAlways)return(e=this.getInfo().validationMetaMap[I(t)])==null||e.lastAbortController.abort(),this.state.meta.errors;const n=this.form.validateAsync(t);return this.validateAsync(t,n)},this.handleChange=t=>{this.setValue(t)},this.handleBlur=()=>{var t,e;this.state.meta.isTouched||(this.setMeta(r=>({...r,isTouched:!0})),this.validate("change")),this.state.meta.isBlurred||this.setMeta(r=>({...r,isBlurred:!0})),this.validate("blur"),(e=(t=this.options.listeners)==null?void 0:t.onBlur)==null||e.call(t,{value:this.state.value,fieldApi:this})},this.form=i.form,this.name=i.name,this.timeoutIds={},i.defaultValue!==void 0&&this.form.setFieldValue(this.name,i.defaultValue,{dontUpdateMeta:!0}),this.store=new E({deps:[this.form.store],fn:()=>{const t=this.form.getFieldValue(this.name),e=this.form.getFieldMeta(this.name)??{isValidating:!1,isTouched:!1,isBlurred:!1,isDirty:!1,isPristine:!0,errors:[],errorMap:{},...i.defaultMeta};return{value:t,meta:e}}}),this.options=i}get state(){return this.store.state}runValidator(i){const t=[this.form.options.validatorAdapter,this.options.validatorAdapter];for(const e of t)if(e&&(typeof i.validate!="function"||"~standard"in i.validate))return e()[i.type](i.value,i.validate);return pe(i.validate)?me()()[i.type](i.value,i.validate):i.validate(i.value)}setErrorMap(i){this.setMeta(t=>({...t,errorMap:{...t.errorMap,...i}}))}}function oe(a){if(a)return typeof a!="string"?"Invalid Form Values":a}function I(a){switch(a){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"change":default:return"onChange"}}var ye={exports:{}},Me={},ge={exports:{}},be={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var O=D;function xe(a,i){return a===i&&(a!==0||1/a===1/i)||a!==a&&i!==i}var Pe=typeof Object.is=="function"?Object.is:xe,Ce=O.useState,Le=O.useEffect,Re=O.useLayoutEffect,Ue=O.useDebugValue;function ze(a,i){var t=i(),e=Ce({inst:{value:t,getSnapshot:i}}),s=e[0].inst,r=e[1];return Re(function(){s.value=t,s.getSnapshot=i,q(s)&&r({inst:s})},[a,t,i]),Le(function(){return q(s)&&r({inst:s}),a(function(){q(s)&&r({inst:s})})},[a]),Ue(t),t}function q(a){var i=a.getSnapshot;a=a.value;try{var t=i();return!Pe(a,t)}catch{return!0}}function Ne(a,i){return i()}var Ke=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Ne:ze;be.useSyncExternalStore=O.useSyncExternalStore!==void 0?O.useSyncExternalStore:Ke;ge.exports=be;var We=ge.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var K=D,Ge=We;function He(a,i){return a===i&&(a!==0||1/a===1/i)||a!==a&&i!==i}var Je=typeof Object.is=="function"?Object.is:He,Qe=Ge.useSyncExternalStore,Xe=K.useRef,Ye=K.useEffect,Ze=K.useMemo,qe=K.useDebugValue;Me.useSyncExternalStoreWithSelector=function(a,i,t,e,s){var r=Xe(null);if(r.current===null){var n={hasValue:!1,value:null};r.current=n}else n=r.current;r=Ze(function(){function u(f){if(!c){if(c=!0,d=f,f=e(f),s!==void 0&&n.hasValue){var m=n.value;if(s(m,f))return h=m}return h=f}if(m=h,Je(d,f))return m;var y=e(f);return s!==void 0&&s(m,y)?(d=f,m):(d=f,h=y)}var c=!1,d,h,l=t===void 0?null:t;return[function(){return u(i())},l===null?void 0:function(){return u(l())}]},[i,t,e,s]);var o=Qe(a,r[0],r[1]);return Ye(function(){n.hasValue=!0,n.value=o},[o]),qe(o),o};ye.exports=Me;var et=ye.exports;function ne(a,i=t=>t){return et.useSyncExternalStoreWithSelector(a.subscribe,()=>a.state,()=>a.state,i,tt)}function tt(a,i){if(Object.is(a,i))return!0;if(typeof a!="object"||a===null||typeof i!="object"||i===null)return!1;if(a instanceof Map&&i instanceof Map){if(a.size!==i.size)return!1;for(const[e,s]of a)if(!i.has(e)||!Object.is(s,i.get(e)))return!1;return!0}if(a instanceof Set&&i instanceof Set){if(a.size!==i.size)return!1;for(const e of a)if(!i.has(e))return!1;return!0}const t=Object.keys(a);if(t.length!==Object.keys(i).length)return!1;for(let e=0;e<t.length;e++)if(!Object.prototype.hasOwnProperty.call(i,t[e])||!Object.is(a[t[e]],i[t[e]]))return!1;return!0}const z=typeof window<"u"?D.useLayoutEffect:D.useEffect;function st(a){const[i]=D.useState(()=>{const e=new je({...a,form:a.form,name:a.name});return e.Field=Ve,e});return z(i.mount,[i]),z(()=>{i.update(a)}),ne(i.store,a.mode==="array"?t=>[t.meta,Object.keys(t.value??[]).length]:void 0),i}const Ve=({children:a,...i})=>{const t=st(i),e=D.useMemo(()=>N(a,t),[a,t,t.state.value,t.state.meta]);return b.jsx(b.Fragment,{children:e})};function it({form:a,selector:i,children:t}){const e=ne(a.store,i);return N(t,e)}function rt(a){const[i]=D.useState(()=>{const t=new Be(a),e=t;return e.Field=function(r){return b.jsx(Ve,{...r,form:t})},e.Subscribe=s=>b.jsx(it,{form:t,selector:s.selector,children:s.children}),e});return z(i.mount,[]),ne(i.store,t=>t.isSubmitting),z(()=>{i.update(a)}),i}const dt={component:ce},at={width:"600px",height:"400px"},L={name:"With Tanstack Form",render:()=>{const a=rt({defaultValues:{text:"Hello tanstack"},onSubmit:i=>alert(JSON.stringify(i.value))});return b.jsxs("form",{onSubmit:i=>{i.preventDefault(),i.stopPropagation(),a.handleSubmit()},children:[b.jsx(a.Field,{name:"text",validators:{onChange:({value:i})=>{if(!i)return"This field is required";if(!i.toLowerCase().includes("tanstack"))return"Text must include tanstack"}},children:i=>b.jsxs(b.Fragment,{children:[b.jsx(ce,{style:at,name:i.name,value:i.state.value,onChange:t=>i.handleChange(t.target.value),onBlur:i.handleBlur,children:t=>t.split("").map((e,s)=>b.jsx("span",{style:{color:"tanstack".includes(e.toLowerCase())?"tan":void 0},children:e},s))}),i.state.meta.errors&&b.jsx("span",{style:{color:"red"},children:i.state.meta.errors.join(", ")})]})}),b.jsx("button",{type:"submit",children:"submit"})]})}};var le,ue,de;L.parameters={...L.parameters,docs:{...(le=L.parameters)==null?void 0:le.docs,source:{originalSource:`{
  name: "With Tanstack Form",
  render: () => {
    const form = useForm({
      defaultValues: {
        text: "Hello tanstack"
      },
      onSubmit: data => alert(JSON.stringify(data.value))
    });
    return <form onSubmit={e => {
      e.preventDefault();
      e.stopPropagation();
      form.handleSubmit();
    }}>
        <form.Field name="text" validators={{
        onChange: ({
          value
        }) => {
          if (!value) {
            return "This field is required";
          }
          if (!value.toLowerCase().includes("tanstack")) {
            return "Text must include tanstack";
          }
        }
      }}>
          {field => <>
              <RichTextarea style={style} name={field.name} value={field.state.value} onChange={e => field.handleChange(e.target.value)} onBlur={field.handleBlur}>
                {v => {
              return v.split("").map((t, i) => <span key={i} style={{
                color: "tanstack".includes(t.toLowerCase()) ? "tan" : undefined
              }}>
                      {t}
                    </span>);
            }}
              </RichTextarea>
              {field.state.meta.errors && <span style={{
            color: "red"
          }}>
                  {field.state.meta.errors.join(", ")}
                </span>}
            </>}
        </form.Field>
        <button type="submit">submit</button>
      </form>;
  }
}`,...(de=(ue=L.parameters)==null?void 0:ue.docs)==null?void 0:de.source}}};const ct=["Default"];export{L as Default,ct as __namedExportsOrder,dt as default};
