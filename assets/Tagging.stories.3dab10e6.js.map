{"version":3,"file":"Tagging.stories.3dab10e6.js","sources":["../../stories/examples/Tagging.stories.tsx"],"sourcesContent":["import { StoryObj } from \"@storybook/react\";\nimport { useState } from \"react\";\nimport { RichTextarea } from \"../../src\";\n\nexport default {\n  component: RichTextarea,\n};\n\nconst INPUT_HEIGHT = 20;\nconst INPUT_WIDTH = 400;\n\nconst style: React.CSSProperties = {\n  height: INPUT_HEIGHT,\n  width: INPUT_WIDTH,\n  whiteSpace: \"pre\",\n  overflowWrap: \"normal\",\n  overflowX: \"auto\",\n  overflowY: \"hidden\",\n  resize: \"none\",\n};\n\nconst SPACER = \" \";\n\nconst Menu = ({\n  items,\n  onSelect,\n}: {\n  items: string[];\n  onSelect: (name: string) => void;\n}) => {\n  return (\n    <div\n      style={{\n        position: \"absolute\",\n        top: INPUT_HEIGHT + 4,\n        left: 0,\n        width: INPUT_WIDTH,\n        fontSize: \"12px\",\n        border: \"solid 1px gray\",\n        borderRadius: \"3px\",\n      }}\n    >\n      <div\n        style={{\n          borderBottom: \"solid 1px gray\",\n        }}\n      >\n        Current tags\n      </div>\n      <ul\n        style={{\n          listStyleType: \"none\",\n          margin: 0,\n          padding: 0,\n          cursor: \"pointer\",\n          background: \"white\",\n        }}\n      >\n        {items.map((item) => (\n          <li key={item} onMouseDown={() => onSelect(item)}>\n            {item}\n          </li>\n        ))}\n      </ul>\n    </div>\n  );\n};\n\nconst Tag = ({\n  children,\n  selected,\n}: {\n  children: string;\n  selected: boolean;\n}) => {\n  return (\n    <span\n      style={{\n        background: selected ? \"lightgray\" : \"whitesmoke\",\n        color: \"dimgray\",\n        borderRadius: \"4px\",\n        outline: \"solid 1px dimgray\",\n      }}\n    >\n      {children}\n    </span>\n  );\n};\n\nexport const Tagging: StoryObj = {\n  render: () => {\n    const [tags, setTags] = useState<string[]>([\"Apple\", \"Orange\", \"Banana\"]);\n    const [text, setText] = useState(\"\");\n    const [pos, setPos] = useState<number | null>(null);\n\n    const [focused, setFocused] = useState(false);\n\n    const tagsText = tags.join(SPACER) + (tags.length ? SPACER : \"\");\n    const textStart = tagsText.length;\n    const tagIndex =\n      pos == null\n        ? -1\n        : tags.reduce(\n            (acc, t, i) => {\n              if (acc[0] !== -1) return acc;\n              const prev = acc[1];\n              acc[1] += t.length + SPACER.length;\n              if (prev <= pos && pos < acc[1]) {\n                acc[0] = i;\n              }\n              return acc;\n            },\n            [-1, 0] as [number, number]\n          )[0];\n\n    return (\n      <div style={{ position: \"relative\", padding: 0 }}>\n        <RichTextarea\n          rows={1}\n          style={style}\n          onChange={(e) => setText(e.target.value.slice(textStart))}\n          value={tagsText + text}\n          onFocus={() => setFocused(true)}\n          onBlur={() => setFocused(false)}\n          onKeyDown={(e) => {\n            if (!pos) return;\n            switch (e.code) {\n              case \"Enter\":\n                e.preventDefault();\n                if (!pos) return;\n                if (!text || tags.includes(text)) return;\n                setTags((prev) => [...prev, text]);\n                setText(\"\");\n                break;\n              case \"Backspace\":\n                if (textStart < pos) return;\n                e.preventDefault();\n                setTags((prev) => {\n                  const next = [...prev];\n                  next.splice(tagIndex === -1 ? prev.length - 1 : tagIndex, 1);\n                  return next;\n                });\n                break;\n              case \"Delete\":\n                if (textStart < pos) return;\n                e.preventDefault();\n                break;\n              default:\n                break;\n            }\n          }}\n          onSelectionChange={(r) => {\n            if (r.focused) {\n              setPos(r.selectionStart);\n            } else {\n              setPos(null);\n            }\n          }}\n        >\n          {() => {\n            return [\n              ...tags.flatMap((t, i) => [\n                <Tag key={t} selected={i == tagIndex}>\n                  {t}\n                </Tag>,\n                SPACER,\n              ]),\n              text\n                ? text\n                : pos === textStart && (\n                    <span key={\"__placeholder\"} style={{ color: \"darkgray\" }}>\n                      Type anything and press Enter key...\n                    </span>\n                  ),\n            ];\n          }}\n        </RichTextarea>\n        {focused && !!tags.length && (\n          <Menu\n            items={tags}\n            onSelect={(text) => {\n              setTags((prev) => prev.filter((p) => p !== text));\n            }}\n          />\n        )}\n      </div>\n    );\n  },\n};\n"],"names":["Tagging_stories","component","RichTextarea","INPUT_HEIGHT","INPUT_WIDTH","style","height","width","whiteSpace","overflowWrap","overflowX","overflowY","resize","SPACER","Menu","items","onSelect","position","top","left","fontSize","border","borderRadius","_jsx","borderBottom","listStyleType","margin","padding","cursor","background","map","item","Tag","children","selected","color","outline","Tagging","render","tags","setTags","useState","text","setText","pos","setPos","focused","setFocused","tagsText","join","length","textStart","tagIndex","reduce","acc","t","i","prev","e","target","value","slice","code","preventDefault","includes","next","splice","r","selectionStart","flatMap","filter","p"],"mappings":"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"}