import{u as ue,s as ce,r as u,b as J,g as le,c as de,d as pe,e as w,f as I,h as me,i as he,k as fe,l as ve,m as ge,a as Q,n as X,j as f,o as S,p as Ee}from"./useStatic-0a5cdcfd.js";import{r as s}from"./index-90fda323.js";const xe=f("span",{style:{color:"transparent"},children:"â€‹"}),R=s.forwardRef(({children:v,value:c,autoHeight:d,style:i,onKeyDown:l,onSelectionChange:k,...oe},se)=>{const p=s.useRef(null),E=s.useRef(null),[[T,z,ie,re],P]=s.useState([0,0,0,0]),[O,H]=s.useState(!1),ae=s.useRef(""),V=s.useRef(null),a=ue(()=>Ee(p)),[x,y]=ce.useSyncExternalStore(a._subscribe,a._getSelection,a._getSelection),L=T+ie,b=z+re,U=!!(L+b);return s.useImperativeHandle(se,()=>{const e=p[u],t={get selectionStart(){const r=a._getSelectionStart();return r??0},get selectionEnd(){const r=a._getSelectionEnd();return r??0},setSelectionRange(...r){e.focus(),e.setSelectionRange(...r)},setRangeText(r,m,h,M){e.setRangeText?e.setRangeText(r,m,h,M):(e.focus(),e.selectionStart=m,e.selectionEnd=h,document.execCommand("insertText",!1,r)),e.dispatchEvent(new Event("input",{bubbles:!0}))}};return new Proxy(e,{get(r,m){if(t[m])return t[m];const h=r[m];return typeof h=="function"?h.bind(r):h}})},[p]),J(()=>{const e=p[u],t=E[u];if(!e||!t)return;const r=new ResizeObserver(([n])=>{const{contentRect:o,borderBoxSize:g}=n;if(g&&g[0]){P([o.width,o.height,g[0].inlineSize-o.width,g[0].blockSize-o.height]);return}const G=le(e);P([o.width,o.height,de(G),pe(G)])}),m=()=>{H(!0)},h=()=>{H(!1)},M=()=>{const{scrollTop:n,scrollLeft:o}=e;t.style.transform=`translate(${-o}px, ${-n}px)`},W=n=>{a._updateSeletion();const o=()=>{a._updateSeletion(),document.removeEventListener("mouseup",o)};document.addEventListener("mouseup",o);const g=w(e,t,n);g&&I(g,n)},B=n=>{const o=w(e,t,n);o&&I(o,n)},j=n=>{const o=w(e,t,n);me(o,V,n)},A=n=>{he(V,n,null)},$=n=>{const o=w(e,t,n);o&&I(o,n)},q=()=>{a._updateSeletion()},N=n=>{a._setComposition(n)},F=n=>{a._setComposition(n)},D=()=>{a._setComposition()};return e.addEventListener("focus",m),e.addEventListener("blur",h),e.addEventListener("scroll",M),e.addEventListener("mousedown",W),e.addEventListener("mouseup",B),e.addEventListener("mousemove",j),e.addEventListener("mouseleave",A),e.addEventListener("click",$),e.addEventListener("input",q),e.addEventListener("compositionstart",N),e.addEventListener("compositionupdate",F),e.addEventListener("compositionend",D),r.observe(e),()=>{e.removeEventListener("focus",m),e.removeEventListener("blur",h),e.removeEventListener("scroll",M),e.removeEventListener("mousedown",W),e.removeEventListener("mouseup",B),e.removeEventListener("mousemove",j),e.removeEventListener("mouseleave",A),e.removeEventListener("click",$),e.removeEventListener("input",q),e.removeEventListener("compositionstart",N),e.removeEventListener("compositionupdate",F),e.removeEventListener("compositionend",D),r.disconnect()}},[]),J(()=>{const e=p[u],t=E[u];!t||!e||fe(e,t,ae,i)},[i]),s.useEffect(()=>{if(!(x==null||y==null||!k))if(!O)k({focused:!1,selectionStart:x,selectionEnd:y},c);else{const t=ve(E[u],x,x+1).getBoundingClientRect();k({focused:!0,top:t.top,left:t.left,height:t.height,selectionStart:x,selectionEnd:y},c)}},[O,x,y]),s.useEffect(()=>{if(ge())return a._subscribe(()=>{if(!p[u]||!E[u])return;const{scrollTop:e,scrollLeft:t}=p[u];E[u].style.transform=`translate(${-t}px, ${-e}px)`})},[]),s.useEffect(()=>{const e=p[u];!d||!e||(e.style.height="auto",e.style.height=`${e.scrollHeight}px`)}),Q("div",{style:s.useMemo(()=>{let e=L,t=b;return i&&(X(i.width)&&(e=i.width),X(i.height)&&(t=i.height)),{display:"inline-block",position:"relative",width:e,height:t}},[L,b,i]),children:[f("div",{style:s.useMemo(()=>{const e={position:"absolute",overflow:"hidden",top:0,left:0,width:L,height:b};return i&&["background","backgroundColor"].forEach(t=>{i[t]&&(e[t]=i[t])}),e},[L,b,i]),children:f("div",{ref:E,"aria-hidden":!0,onClick:S,onMouseDown:S,onMouseUp:S,onMouseOver:S,onMouseOut:S,onMouseMove:S,children:f("div",{style:{width:T,height:z,overflow:"hidden"},children:Q("div",{style:s.useMemo(()=>({transform:"translate(0px, 0px)",pointerEvents:"none",userSelect:"none",msUserSelect:"none",WebkitUserSelect:"none",boxSizing:"content-box",textSizeAdjust:"100%",WebkitTextSizeAdjust:"100%",whiteSpace:"pre"}),[]),children:[s.useMemo(()=>v?v(c):c,[c,v]),xe]})})})}),f("input",{...oe,ref:p,value:c,style:s.useMemo(()=>({...i,background:"transparent",margin:0,position:"absolute",...!U&&{position:void 0,verticalAlign:"top"}}),[i,U]),onKeyDown:s.useCallback(e=>{e.nativeEvent.isComposing||e.nativeEvent.keyCode===229||(l==null||l(e),a._updateSeletion())},[l])})]})});try{R.displayName="RichInput",R.__docgenInfo={description:"Input component with some extra props. See {@link RichInputProps} and {@link RichInputHandle}.",displayName:"RichInput",props:{children:{defaultValue:null,description:"Render function to create customized view from value.\n\nThis function should return ReactNodes which texts are positioned the same as textarea (see examples for detailed usage).\n\nOn the rendered nodes, currently limited event handlers will work.\n- `onClick`\n- `onMouseOver`\n- `onMouseOut`\n- `onMouseMove`\n- `onMouseDown`\n- `onMouseUp`\n@defaultValue undefined",name:"children",required:!1,type:{name:"Renderer"}},value:{defaultValue:null,description:"Same as original but only string",name:"value",required:!0,type:{name:"string"}},autoHeight:{defaultValue:null,description:"If true, textarea height is automatically resized and height of style prop does not work. Set `maxHeight` to style prop if you need limit.\n@defaultValue undefined",name:"autoHeight",required:!1,type:{name:"boolean"}},onSelectionChange:{defaultValue:null,description:`Called when selection in textarea changes. It gives position of caret at the time, which is useful to position menu.
@defaultValue undefined`,name:"onSelectionChange",required:!1,type:{name:"(pos: CaretPosition, value: string) => void"}}}}}catch{}const Re={component:R},Se={paddingLeft:10,paddingRight:10},C={render:()=>{const[v,c]=s.useState("Lorem ipsum");return f(R,{style:Se,onChange:d=>c(d.target.value),value:v,children:d=>d.split("").map((i,l)=>f("span",{style:{color:l%2===0?"red":void 0},children:i},l))})}},_={render:()=>{const[v,c]=s.useState("Lorem ipsum");return f(R,{style:{width:"100%"},onChange:d=>c(d.target.value),value:v,children:d=>d.split("").map((i,l)=>f("span",{style:{color:l%2===0?"red":void 0},children:i},l))})},name:"Width 100%"};var Y,Z,K;C.parameters={...C.parameters,docs:{...(Y=C.parameters)==null?void 0:Y.docs,source:{originalSource:`{
  render: () => {
    const [text, setText] = useState("Lorem ipsum");
    return <RichInput style={style} onChange={e => setText(e.target.value)} value={text}>
        {v => {
        return v.split("").map((t, i) => <span key={i} style={{
          color: i % 2 === 0 ? "red" : undefined
        }}>
              {t}
            </span>);
      }}
      </RichInput>;
  }
}`,...(K=(Z=C.parameters)==null?void 0:Z.docs)==null?void 0:K.source}}};var ee,te,ne;_.parameters={..._.parameters,docs:{...(ee=_.parameters)==null?void 0:ee.docs,source:{originalSource:`{
  render: () => {
    const [text, setText] = useState("Lorem ipsum");
    return <RichInput style={{
      width: "100%"
    }} onChange={e => setText(e.target.value)} value={text}>
        {v => {
        return v.split("").map((t, i) => <span key={i} style={{
          color: i % 2 === 0 ? "red" : undefined
        }}>
              {t}
            </span>);
      }}
      </RichInput>;
  },
  name: "Width 100%"
}`,...(ne=(te=_.parameters)==null?void 0:te.docs)==null?void 0:ne.source}}};const ye=["Basic","WidthMax"];export{C as Basic,_ as WidthMax,ye as __namedExportsOrder,Re as default};
//# sourceMappingURL=2-Input.stories-4d81fb85.js.map
