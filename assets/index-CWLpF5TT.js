import{j as S}from"./jsx-runtime-D_zvdyIk.js";import{a as M}from"./observer-BRJyxK-O.js";import{r as w}from"./iframe-6r5P-tC5.js";const R=(t,c,e)=>{const n=[];let o=null;for(;o=t.exec(c);)e&&!e(c,o)||n.push(o);return n},T=t=>{const c=t.map(([,e])=>e);return e=>{const[n,o,l]=t.reduce((s,[h,d,y])=>(R(h,e,y).forEach(f=>{const p=f.index,x=f.index+f[0].length;s[0].add(p).add(x);let i=s[1].get(p),a=s[2].get(x);i||s[1].set(p,i=[]),a||s[2].set(x,a=[]),i.push(d),a.push(d)}),s),[new Set,new Map,new Map]),r=Array.from(n);r.sort((s,h)=>s-h);let m=0;const g=[],u=[];for(let s=0;s<r.length;s++){const h=r[s],d=r[s+1]??e.length;if(h===d)continue;const y=e.slice(m,h);y&&u.push(y);const f=o.get(h),p=l.get(d);f&&(f.forEach(i=>{g.push(i)}),g.sort((i,a)=>c.indexOf(a)-c.indexOf(i)));const x=e.slice(h,d);u.push(g.reduceRight((i,a,H)=>{const C=H===0?String(h):void 0;return typeof a=="function"?a({children:i,value:x,key:C}):S.jsx("span",{style:a,children:i},C)},x)),p&&p.forEach(i=>{g.splice(g.indexOf(i),1)}),m=d}const j=e.slice(m);return j&&u.push(j),u}},E=t=>`rich-textarea-${t}`,_=w.memo(({_value:t,_regexes:c})=>{const e=w.useRef(null);return M(()=>{const n=e.current.firstChild,o=c.map(l=>new Highlight(...R(l,t).map(r=>{const m=r.index,g=r.index+r[0].length,u=new Range;return u.setStart(n,m),u.setEnd(n,g),u})));return o.forEach((l,r)=>{CSS.highlights.set(E(r),l)}),()=>{o.forEach((l,r)=>{CSS.highlights.delete(E(r)),l.clear()})}},[t]),S.jsx("div",{ref:e,children:t})}),V=t=>{const c=t.reduce((n,[,o],l)=>n+`::highlight(${E(l)}){${o}}`,""),e=t.map(([n])=>n);return n=>S.jsxs(S.Fragment,{children:[S.jsx(_,{_value:n,_regexes:e}),S.jsx("style",{children:c})]})};export{V as a,T as c};
