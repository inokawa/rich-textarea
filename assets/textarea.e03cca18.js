import{r as t}from"./index.8e45f264.js";import{i as M,s as D,g as ee,a as te,b as re,c as se,d as ae,e as p,f as z,h as w,j as ne,k as ce}from"./selection.f2e9739e.js";import{a as G,j as q}from"./jsx-runtime.96752331.js";const ie=q("span",{style:{color:"transparent"},children:"\u200B"}),V=t.exports.forwardRef(({children:x,value:d,autoHeight:I,style:l,onScroll:h,onInput:g,onCompositionStart:b,onCompositionUpdate:v,onCompositionEnd:E,onKeyDown:R,onClick:S,onMouseDown:_,onMouseUp:m,onMouseMove:k,onMouseLeave:T,onFocus:y,onBlur:C,onSelectionChange:j,...J},Q)=>{const c=t.exports.useRef(null),o=t.exports.useRef(null),[[L,W],X]=t.exports.useState([0,0]),[[H,Z,K,F],$]=t.exports.useState([0,0,0,0]),[B,N]=t.exports.useState(!1),U=t.exports.useRef(""),Y=t.exports.useRef(null),i=t.exports.useState(()=>M(c))[0],[f,O]=D.exports.useSyncExternalStore(i._subscribe,i._getSelection),P=H+K,A=Z+F;return t.exports.useImperativeHandle(Q,()=>{const e=c.current,r={get selectionStart(){const s=i._getSelectionStart();return s==null?0:s},get selectionEnd(){const s=i._getSelectionEnd();return s==null?0:s},setSelectionRange(...s){e.focus(),e.setSelectionRange(...s)},setRangeText(s,a,n,u){e.setRangeText?e.setRangeText(s,a,n,u):(e.focus(),e.selectionStart=a,e.selectionEnd=n,document.execCommand("insertText",!1,s)),e.dispatchEvent(new Event("input",{bubbles:!0}))}};return new Proxy(e,{get(s,a){if(r[a])return r[a];const n=s[a];return typeof n=="function"?n.bind(s):n}})},[c]),t.exports.useLayoutEffect(()=>{const e=c.current;if(!e)return;const r=new ResizeObserver(([s])=>{const{contentRect:a,borderBoxSize:n}=s;if(n&&n[0]){$([a.width,a.height,n[0].inlineSize-a.width,n[0].blockSize-a.height]);return}const u=ee(e);$([a.width,a.height,te(u),re(u)])});return r.observe(e),()=>{r.disconnect()}},[]),t.exports.useLayoutEffect(()=>{const e=c.current,r=o.current;!r||!e||se(e,r,U,l)},[l]),t.exports.useEffect(()=>{if(!(f==null||O==null||!j))if(!B)j({focused:!1,selectionStart:f,selectionEnd:O},d);else{const r=ae(o.current,f,f+1).getBoundingClientRect();j({focused:!0,top:r.top,left:r.left,height:r.height,selectionStart:f,selectionEnd:O},d)}},[B,f,O]),t.exports.useEffect(()=>{const e=c.current;!I||!e||(e.style.height="auto",e.style.height=`${e.scrollHeight}px`)}),G("div",{style:t.exports.useMemo(()=>({display:"inline-block",position:"relative",width:P,height:A}),[P,A]),children:[q("div",{style:t.exports.useMemo(()=>{const e={position:"absolute",overflow:"hidden",top:0,left:0,width:P,height:A};return l&&["background","backgroundColor"].forEach(r=>{l[r]&&(e[r]=l[r])}),e},[P,A,l]),children:G("div",{ref:o,"aria-hidden":!0,style:t.exports.useMemo(()=>({width:H,transform:`translate(${-L}px, ${-W}px)`,pointerEvents:"none",userSelect:"none",msUserSelect:"none",WebkitUserSelect:"none",textSizeAdjust:"100%",WebkitTextSizeAdjust:"100%"}),[L,W,H]),onClick:p,onMouseDown:p,onMouseUp:p,onMouseOver:p,onMouseOut:p,onMouseMove:p,children:[t.exports.useMemo(()=>x?x(d):d,[d,x]),ie]})}),q("textarea",{...J,ref:c,value:d,style:t.exports.useMemo(()=>({...l,background:"transparent",margin:0,position:"absolute"}),[l]),onScroll:t.exports.useCallback(e=>{X([e.currentTarget.scrollLeft,e.currentTarget.scrollTop]),h==null||h(e)},[h]),onInput:t.exports.useCallback(e=>{g==null||g(e),i._update()},[g]),onCompositionStart:t.exports.useCallback(e=>{i._setComposition(e.nativeEvent),b==null||b(e)},[b]),onCompositionUpdate:t.exports.useCallback(e=>{i._setComposition(e.nativeEvent),v==null||v(e)},[v]),onCompositionEnd:t.exports.useCallback(e=>{i._setComposition(null),E==null||E(e)},[E]),onKeyDown:t.exports.useCallback(e=>{e.nativeEvent.isComposing||e.nativeEvent.keyCode===229||(R==null||R(e),i._update())},[R]),onClick:t.exports.useCallback(e=>{S==null||S(e);const r=c.current,s=o.current;if(!r||!s)return;const a=z(r,s,e);a&&w(a,e.nativeEvent)},[S]),onMouseDown:t.exports.useCallback(e=>{_==null||_(e),i._update();const r="mouseup",s=()=>{i._update(),document.removeEventListener(r,s)};document.addEventListener(r,s);const a=c.current,n=o.current;if(!a||!n)return;const u=z(a,n,e);u&&w(u,e.nativeEvent)},[_]),onMouseUp:t.exports.useCallback(e=>{m==null||m(e);const r=c.current,s=o.current;if(!r||!s)return;const a=z(r,s,e);a&&w(a,e.nativeEvent)},[m]),onMouseMove:t.exports.useCallback(e=>{k==null||k(e);const r=c.current,s=o.current;if(!r||!s)return;const a=z(r,s,e);ne(a,Y,e.nativeEvent)},[k]),onMouseLeave:t.exports.useCallback(e=>{T==null||T(e),ce(Y,e.nativeEvent,null)},[T]),onFocus:t.exports.useCallback(e=>{y==null||y(e),N(!0)},[y]),onBlur:t.exports.useCallback(e=>{C==null||C(e),N(!1)},[C])})]})});try{V.displayName="RichTextarea",V.__docgenInfo={description:"",displayName:"RichTextarea",props:{value:{defaultValue:null,description:"",name:"value",required:!0,type:{name:"string"}},autoHeight:{defaultValue:null,description:"",name:"autoHeight",required:!1,type:{name:"boolean"}},onSelectionChange:{defaultValue:null,description:"",name:"onSelectionChange",required:!1,type:{name:"(pos: CaretPosition, value: string) => void"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/textarea.tsx#RichTextarea"]={docgenInfo:V.__docgenInfo,name:"RichTextarea",path:"src/textarea.tsx#RichTextarea"})}catch{}export{V as R};
//# sourceMappingURL=textarea.e03cca18.js.map
