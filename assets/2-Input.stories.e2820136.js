import"./index.46cfd363.js";import{r as t}from"./index.8e45f264.js";import{a as Q,j as f}from"./jsx-runtime.96752331.js";import{i as M,s as D,g as ee,a as te,b as re,c as se,d as ne,l as ae,e as g,f as w,h as L,j as ce,k as ie}from"./selection.f2e9739e.js";import"./chunk-Y6TTZ4RO.672b857c.js";import"./iframe.047c3e6d.js";import"./index.68bde87c.js";const oe=f("span",{style:{color:"transparent"},children:"\u200B"}),v=t.exports.forwardRef(({children:x,value:u,autoHeight:b,style:o,onScroll:l,onInput:m,onCompositionStart:E,onCompositionUpdate:S,onCompositionEnd:_,onKeyDown:R,onClick:k,onMouseDown:y,onMouseUp:T,onMouseMove:C,onMouseLeave:O,onFocus:P,onBlur:A,onSelectionChange:H,...X},Z)=>{const c=t.exports.useRef(null),d=t.exports.useRef(null),[[B,V],q]=t.exports.useState([0,0]),[[W,$,K,F],N]=t.exports.useState([0,0,0,0]),[Y,G]=t.exports.useState(!1),U=t.exports.useRef(""),J=t.exports.useRef(null),i=t.exports.useState(()=>M(c))[0],[h,z]=D.exports.useSyncExternalStore(i._subscribe,i._getSelection),I=W+K,j=$+F;return t.exports.useImperativeHandle(Z,()=>{const e=c.current,r={get selectionStart(){const s=i._getSelectionStart();return s==null?0:s},get selectionEnd(){const s=i._getSelectionEnd();return s==null?0:s},setSelectionRange(...s){e.focus(),e.setSelectionRange(...s)},setRangeText(s,n,a,p){e.setRangeText?e.setRangeText(s,n,a,p):(e.focus(),e.selectionStart=n,e.selectionEnd=a,document.execCommand("insertText",!1,s)),e.dispatchEvent(new Event("input",{bubbles:!0}))}};return new Proxy(e,{get(s,n){if(r[n])return r[n];const a=s[n];return typeof a=="function"?a.bind(s):a}})},[c]),t.exports.useLayoutEffect(()=>{const e=c.current;if(!e)return;const r=new ResizeObserver(([s])=>{const{contentRect:n,borderBoxSize:a}=s;if(a&&a[0]){N([n.width,n.height,a[0].inlineSize-n.width,a[0].blockSize-n.height]);return}const p=ee(e);N([n.width,n.height,te(p),re(p)])});return r.observe(e),()=>{r.disconnect()}},[]),t.exports.useLayoutEffect(()=>{const e=c.current,r=d.current;!r||!e||se(e,r,U,o)},[o]),t.exports.useEffect(()=>{if(!(h==null||z==null||!H))if(!Y)H({focused:!1,selectionStart:h,selectionEnd:z},u);else{const r=ne(d.current,h,h+1).getBoundingClientRect();H({focused:!0,top:r.top,left:r.left,height:r.height,selectionStart:h,selectionEnd:z},u)}},[Y,h,z]),t.exports.useEffect(()=>{if(!!ae())return i._subscribe(()=>{const e=c.current;!e||q([e.scrollLeft,e.scrollTop])})},[]),t.exports.useEffect(()=>{const e=c.current;!b||!e||(e.style.height="auto",e.style.height=`${e.scrollHeight}px`)}),Q("div",{style:t.exports.useMemo(()=>({display:"inline-block",position:"relative",width:I,height:j}),[I,j]),children:[f("div",{style:t.exports.useMemo(()=>{const e={position:"absolute",overflow:"hidden",top:0,left:0,width:I,height:j};return o&&["background","backgroundColor"].forEach(r=>{o[r]&&(e[r]=o[r])}),e},[I,j,o]),children:f("div",{ref:d,"aria-hidden":!0,onClick:g,onMouseDown:g,onMouseUp:g,onMouseOver:g,onMouseOut:g,onMouseMove:g,children:f("div",{style:{width:W,height:$,overflow:"hidden"},children:Q("div",{style:t.exports.useMemo(()=>({transform:`translate(${-B}px, ${-V}px)`,pointerEvents:"none",userSelect:"none",msUserSelect:"none",WebkitUserSelect:"none",textSizeAdjust:"100%",WebkitTextSizeAdjust:"100%",whiteSpace:"pre"}),[B,V]),children:[t.exports.useMemo(()=>x?x(u):u,[u,x]),oe]})})})}),f("input",{...X,ref:c,value:u,style:t.exports.useMemo(()=>({...o,background:"transparent",margin:0,position:"absolute"}),[o]),onScroll:t.exports.useCallback(e=>{q([e.currentTarget.scrollLeft,e.currentTarget.scrollTop]),l==null||l(e)},[l]),onInput:t.exports.useCallback(e=>{m==null||m(e),i._update()},[m]),onCompositionStart:t.exports.useCallback(e=>{i._setComposition(e.nativeEvent),E==null||E(e)},[E]),onCompositionUpdate:t.exports.useCallback(e=>{i._setComposition(e.nativeEvent),S==null||S(e)},[S]),onCompositionEnd:t.exports.useCallback(e=>{i._setComposition(null),_==null||_(e)},[_]),onKeyDown:t.exports.useCallback(e=>{e.nativeEvent.isComposing||e.nativeEvent.keyCode===229||(R==null||R(e),i._update())},[R]),onClick:t.exports.useCallback(e=>{k==null||k(e);const r=c.current,s=d.current;if(!r||!s)return;const n=w(r,s,e);n&&L(n,e.nativeEvent)},[k]),onMouseDown:t.exports.useCallback(e=>{y==null||y(e),i._update();const r="mouseup",s=()=>{i._update(),document.removeEventListener(r,s)};document.addEventListener(r,s);const n=c.current,a=d.current;if(!n||!a)return;const p=w(n,a,e);p&&L(p,e.nativeEvent)},[y]),onMouseUp:t.exports.useCallback(e=>{T==null||T(e);const r=c.current,s=d.current;if(!r||!s)return;const n=w(r,s,e);n&&L(n,e.nativeEvent)},[T]),onMouseMove:t.exports.useCallback(e=>{C==null||C(e);const r=c.current,s=d.current;if(!r||!s)return;const n=w(r,s,e);ce(n,J,e.nativeEvent)},[C]),onMouseLeave:t.exports.useCallback(e=>{O==null||O(e),ie(J,e.nativeEvent,null)},[O]),onFocus:t.exports.useCallback(e=>{P==null||P(e),G(!0)},[P]),onBlur:t.exports.useCallback(e=>{A==null||A(e),G(!1)},[A])})]})});try{v.displayName="RichInput",v.__docgenInfo={description:"",displayName:"RichInput",props:{value:{defaultValue:null,description:"",name:"value",required:!0,type:{name:"string"}},autoHeight:{defaultValue:null,description:"",name:"autoHeight",required:!1,type:{name:"boolean"}},onSelectionChange:{defaultValue:null,description:"",name:"onSelectionChange",required:!1,type:{name:"(pos: CaretPosition, value: string) => void"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/input.tsx#RichInput"]={docgenInfo:v.__docgenInfo,name:"RichInput",path:"src/input.tsx#RichInput"})}catch{}const be={component:v},ue={paddingLeft:10,paddingRight:10},ve={render:()=>{const[x,u]=t.exports.useState("Lorem ipsum");return f(v,{style:ue,onChange:b=>u(b.target.value),value:x,children:b=>b.split("").map((o,l)=>f("span",{style:{color:l%2===0?"red":void 0},children:o},l))})}},me=["Basic"];export{ve as Basic,me as __namedExportsOrder,be as default};
//# sourceMappingURL=2-Input.stories.e2820136.js.map
