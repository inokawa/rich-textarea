{"version":3,"file":"Mention.stories.3bb678c7.js","sources":["../../stories/examples/Mention.stories.tsx"],"sourcesContent":["import { StoryObj } from \"@storybook/react\";\nimport { useMemo, useRef, useState } from \"react\";\nimport { createPortal } from \"react-dom\";\nimport { RichTextarea, createRegexRenderer, RichTextareaHandle } from \"../../src\";\nimport { CHARACTERS } from \"../mocks\";\n\nexport default {\n  component: RichTextarea,\n};\n\nconst style = { width: \"400px\", height: \"300px\" };\n\nconst MAX_CHARS = 8;\nconst MENTION_REG = /\\B@([\\-+\\w]*)$/;\nconst MENTION_HIGHLIGHT_REG = new RegExp(\n  `(${CHARACTERS.map((c) => `@${c}`).join(\"|\")})`,\n  \"g\"\n);\nconst mentionRenderer = createRegexRenderer([\n  [\n    MENTION_HIGHLIGHT_REG,\n    { background: \"#EAF5F9\", color: \"#4276AA\", borderRadius: \"3px\" },\n  ],\n]);\n\nconst Menu = ({\n  chars,\n  index,\n  top,\n  left,\n  complete,\n}: {\n  chars: string[];\n  index: number;\n  top: number;\n  left: number;\n  complete: (index: number) => void;\n}) => {\n  return (\n    <div\n      style={{\n        position: \"fixed\",\n        top: top,\n        left: left,\n        fontSize: \"12px\",\n        border: \"solid 1px gray\",\n        borderRadius: \"3px\",\n        background: \"white\",\n        cursor: \"pointer\",\n      }}\n    >\n      {chars.map((c, i) => (\n        <div\n          key={c}\n          style={{\n            padding: \"4px\",\n            ...(index === i && {\n              color: \"white\",\n              background: \"#2A6AD3\",\n            }),\n          }}\n          onMouseDown={(e) => {\n            e.preventDefault();\n            complete(i);\n          }}\n        >\n          {c}\n        </div>\n      ))}\n    </div>\n  );\n};\n\nexport const Mention: StoryObj = {\n  render: () => {\n    const ref = useRef<RichTextareaHandle>(null);\n    const [text, setText] = useState(\n      `Hi, @Captain Gregor and @Jaxxon . Please enter @ to show suggestions.\\n\\n`\n    );\n    const [pos, setPos] = useState<{\n      top: number;\n      left: number;\n      caret: number;\n    } | null>(null);\n    const [index, setIndex] = useState<number>(0);\n\n    const targetText = pos ? text.slice(0, pos.caret) : text;\n    const match = pos && targetText.match(MENTION_REG);\n    const name = match?.[1] ?? \"\";\n    const chars = useMemo(\n      () =>\n        CHARACTERS.filter((c) =>\n          c.toLowerCase().startsWith(name.toLowerCase())\n        ).slice(0, MAX_CHARS),\n      [name]\n    );\n    const complete = (i: number) => {\n      if (!ref.current || !pos) return;\n      const selected = chars[i];\n      ref.current.setRangeText(\n        `@${selected} `,\n        pos.caret - name.length - 1,\n        pos.caret,\n        \"end\"\n      );\n      setPos(null);\n      setIndex(0);\n    };\n\n    return (\n      <div>\n        <RichTextarea\n          ref={ref}\n          style={style}\n          onChange={(e) => setText(e.target.value)}\n          value={text}\n          onKeyDown={(e) => {\n            if (!pos || !chars.length) return;\n            switch (e.code) {\n              case \"ArrowUp\":\n                e.preventDefault();\n                const nextIndex = index <= 0 ? chars.length - 1 : index - 1;\n                setIndex(nextIndex);\n                break;\n              case \"ArrowDown\":\n                e.preventDefault();\n                const prevIndex = index >= chars.length - 1 ? 0 : index + 1;\n                setIndex(prevIndex);\n                break;\n              case \"Enter\":\n                e.preventDefault();\n                complete(index);\n                break;\n              case \"Escape\":\n                e.preventDefault();\n                setPos(null);\n                setIndex(0);\n                break;\n              default:\n                break;\n            }\n          }}\n          onSelectionChange={(r) => {\n            if (\n              r.focused &&\n              MENTION_REG.test(text.slice(0, r.selectionStart))\n            ) {\n              setPos({\n                top: r.top + r.height,\n                left: r.left,\n                caret: r.selectionStart,\n              });\n              setIndex(0);\n            } else {\n              setPos(null);\n              setIndex(0);\n            }\n          }}\n        >\n          {mentionRenderer}\n        </RichTextarea>\n        {pos &&\n          createPortal(\n            <Menu\n              top={pos.top}\n              left={pos.left}\n              chars={chars}\n              index={index}\n              complete={complete}\n            />,\n            document.body\n          )}\n      </div>\n    );\n  },\n};\n"],"names":["Mention_stories","component","RichTextarea","style","width","height","MAX_CHARS","MENTION_REG","MENTION_HIGHLIGHT_REG","RegExp","CHARACTERS","map","c","join","mentionRenderer","createRegexRenderer","background","color","borderRadius","Menu","chars","index","top","left","complete","position","fontSize","border","cursor","i","padding","e","preventDefault","Mention","render","ref","useRef","text","setText","useState","pos","setPos","setIndex","targetText","slice","caret","match","name","useMemo","filter","toLowerCase","startsWith","current","selected","setRangeText","length","_jsx","target","value","code","nextIndex","prevIndex","r","focused","test","selectionStart","createPortal","document","body"],"mappings":"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"}