import{j as _}from"./jsx-runtime-Dp96wDEE.js";import{a as Ee,r as W}from"./iframe-e0PEXjEq.js";import{R as we}from"./textarea-B8ORlT-g.js";import"./preload-helper-D9Z9MdNV.js";import"./observer-C1Yv_ZWd.js";const I=new WeakMap,H=new WeakMap,Q={current:[]};let se=!1,j=0;const B=new Set,x=new Map;function _e(a){const r=Array.from(a).sort((t,e)=>t instanceof k&&t.options.deps.includes(e)?1:e instanceof k&&e.options.deps.includes(t)?-1:0);for(const t of r){if(Q.current.includes(t))continue;Q.current.push(t),t.recompute();const e=H.get(t);if(e)for(const s of e){const i=I.get(s);i&&_e(i)}}}function Te(a){a.listeners.forEach(r=>r({prevVal:a.prevState,currentVal:a.state}))}function Ie(a){a.listeners.forEach(r=>r({prevVal:a.prevState,currentVal:a.state}))}function Ae(a){if(j>0&&!x.has(a)&&x.set(a,a.prevState),B.add(a),!(j>0)&&!se)try{for(se=!0;B.size>0;){const r=Array.from(B);B.clear();for(const t of r){const e=x.get(t)??t.prevState;t.prevState=e,Te(t)}for(const t of r){const e=I.get(t);e&&(Q.current.push(t),_e(e))}for(const t of r){const e=I.get(t);if(e)for(const s of e)Ie(s)}}}finally{se=!1,Q.current=[],x.clear()}}function O(a){j++;try{a()}finally{if(j--,j===0){const r=Array.from(B)[0];r&&Ae(r)}}}class le{constructor(r,t){this.listeners=new Set,this.subscribe=e=>{var s,i;this.listeners.add(e);const n=(i=(s=this.options)==null?void 0:s.onSubscribe)==null?void 0:i.call(s,e,this);return()=>{this.listeners.delete(e),n?.()}},this.setState=e=>{var s,i,n;this.prevState=this.state,this.state=(s=this.options)!=null&&s.updateFn?this.options.updateFn(this.prevState)(e):e(this.prevState),(n=(i=this.options)==null?void 0:i.onUpdate)==null||n.call(i),Ae(this)},this.prevState=r,this.state=r,this.options=t}}class k{constructor(r){this.listeners=new Set,this._subscriptions=[],this.lastSeenDepValues=[],this.getDepVals=()=>{const t=[],e=[];for(const s of this.options.deps)t.push(s.prevState),e.push(s.state);return this.lastSeenDepValues=e,{prevDepVals:t,currDepVals:e,prevVal:this.prevState??void 0}},this.recompute=()=>{var t,e;this.prevState=this.state;const{prevDepVals:s,currDepVals:i,prevVal:n}=this.getDepVals();this.state=this.options.fn({prevDepVals:s,currDepVals:i,prevVal:n}),(e=(t=this.options).onUpdate)==null||e.call(t)},this.checkIfRecalculationNeededDeeply=()=>{for(const i of this.options.deps)i instanceof k&&i.checkIfRecalculationNeededDeeply();let t=!1;const e=this.lastSeenDepValues,{currDepVals:s}=this.getDepVals();for(let i=0;i<s.length;i++)if(s[i]!==e[i]){t=!0;break}t&&this.recompute()},this.mount=()=>(this.registerOnGraph(),this.checkIfRecalculationNeededDeeply(),()=>{this.unregisterFromGraph();for(const t of this._subscriptions)t()}),this.subscribe=t=>{var e,s;this.listeners.add(t);const i=(s=(e=this.options).onSubscribe)==null?void 0:s.call(e,t,this);return()=>{this.listeners.delete(t),i?.()}},this.options=r,this.state=r.fn({prevDepVals:void 0,prevVal:void 0,currDepVals:this.getDepVals().currDepVals})}registerOnGraph(r=this.options.deps){for(const t of r)if(t instanceof k)t.registerOnGraph(),this.registerOnGraph(t.options.deps);else if(t instanceof le){let e=I.get(t);e||(e=new Set,I.set(t,e)),e.add(this);let s=H.get(this);s||(s=new Set,H.set(this,s)),s.add(t)}}unregisterFromGraph(r=this.options.deps){for(const t of r)if(t instanceof k)this.unregisterFromGraph(t.options.deps);else if(t instanceof le){const e=I.get(t);e&&e.delete(this);const s=H.get(this);s&&s.delete(t)}}}function Z(a,r){return typeof a=="function"?a(r):a}function $(a,r){return fe(r).reduce((e,s)=>{if(e===null)return null;if(typeof e<"u")return e[s]},a)}function z(a,r,t){const e=fe(r);function s(i){if(!e.length)return Z(t,i);const n=e.shift();if(typeof n=="string"||typeof n=="number"&&!Array.isArray(i))return typeof i=="object"?(i===null&&(i={}),{...i,[n]:s(i[n])}):{[n]:s()};if(Array.isArray(i)&&typeof n=="number"){const u=i.slice(0,n);return[...u.length?u:new Array(n),s(i[n]),...i.slice(n+1)]}return[...new Array(n),s()]}return s(a)}function Ce(a,r){const t=fe(r);function e(s){if(!s)return;if(t.length===1){const n=t[0];if(Array.isArray(s)&&typeof n=="number")return s.filter((d,c)=>c!==n);const{[n]:u,...f}=s;return f}const i=t.shift();if(typeof i=="string"&&typeof s=="object")return{...s,[i]:e(s[i])};if(typeof i=="number"&&Array.isArray(s)){if(i>=s.length)return s;const n=s.slice(0,i);return[...n.length?n:new Array(i),e(s[i]),...s.slice(i+1)]}throw new Error("It seems we have created an infinite loop in deleteBy. ")}return e(a)}const Le=/^(\d+)$/gm,Pe=/\.(\d+)(?=\.)/gm,Be=/^(\d+)\./gm,$e=/\.(\d+$)/gm,je=/\.{2,}/gm,ue="__int__",U=`${ue}$1`;function fe(a){if(Array.isArray(a))return[...a];if(typeof a!="string")throw new Error("Path must be a string.");return a.replace(/(^\[)|]/gm,"").replace(/\[/g,".").replace(Le,U).replace(Pe,`.${U}.`).replace(Be,`${U}.`).replace($e,`.${U}`).replace(je,".").split(".").map(r=>r.indexOf(ue)===0?parseInt(r.substring(ue.length),10):r)}function We(a){return!(Array.isArray(a)&&a.length===0)}function ce(a,r){const{asyncDebounceMs:t}=r,{onChangeAsync:e,onBlurAsync:s,onSubmitAsync:i,onBlurAsyncDebounceMs:n,onChangeAsyncDebounceMs:u}=r.validators||{},f=t??0,d={cause:"change",validate:e,debounceMs:u??f},c={cause:"blur",validate:s,debounceMs:n??f},l={cause:"submit",validate:i,debounceMs:0},o=v=>({...v,debounceMs:0});switch(a){case"submit":return[o(d),o(c),l];case"blur":return[c];case"change":return[d];case"server":default:return[]}}function de(a,r){const{onChange:t,onBlur:e,onSubmit:s,onMount:i}=r.validators||{},n={cause:"change",validate:t},u={cause:"blur",validate:e},f={cause:"submit",validate:s},d={cause:"mount",validate:i},c={cause:"server",validate:()=>{}};switch(a){case"mount":return[d];case"submit":return[n,u,f,c];case"server":return[c];case"blur":return[u,c];case"change":default:return[n,c]}}const he=a=>!!a&&typeof a=="object"&&"fields"in a;function T(a,r){if(Object.is(a,r))return!0;if(typeof a!="object"||a===null||typeof r!="object"||r===null)return!1;if(a instanceof Map&&r instanceof Map){if(a.size!==r.size)return!1;for(const[s,i]of a)if(!r.has(s)||!Object.is(i,r.get(s)))return!1;return!0}if(a instanceof Set&&r instanceof Set){if(a.size!==r.size)return!1;for(const s of a)if(!r.has(s))return!1;return!0}const t=Object.keys(a),e=Object.keys(r);if(t.length!==e.length)return!1;for(const s of t)if(!e.includes(s)||!T(a[s],r[s]))return!1;return!0}const pe=({newFormValidatorError:a,isPreviousErrorFromFormValidator:r,previousErrorValue:t})=>a?{newErrorValue:a,newSource:"form"}:r?{newErrorValue:void 0,newSource:void 0}:t?{newErrorValue:t,newSource:"field"}:{newErrorValue:void 0,newSource:void 0},Me=({formLevelError:a,fieldLevelError:r})=>r?{newErrorValue:r,newSource:"field"}:a?{newErrorValue:a,newSource:"form"}:{newErrorValue:void 0,newSource:void 0};function Re(a){const r=new Map;for(const t of a){const e=[...t.path??[]].map(s=>{const i=typeof s=="object"?s.key:s;return typeof i=="number"?`[${i}]`:i}).join(".").replace(/\.\[/g,"[");r.set(e,(r.get(e)??[]).concat(t))}return Object.fromEntries(r)}const ge=a=>{const r=Re(a);return{form:r,fields:r}},C={validate({value:a,validationSource:r},t){const e=t["~standard"].validate(a);if(e instanceof Promise)throw new Error("async function passed to sync validator");if(e.issues)return r==="field"?e.issues:ge(e.issues)},async validateAsync({value:a,validationSource:r},t){const e=await t["~standard"].validate(a);if(e.issues)return r==="field"?e.issues:ge(e.issues)}},De=a=>!!a&&"~standard"in a,X={isValidating:!1,isTouched:!1,isBlurred:!1,isDirty:!1,isPristine:!0,isValid:!0,isDefaultValue:!0,errors:[],errorMap:{},errorSourceMap:{}};function G(a){function r(l,o,v,h){const m=e(l,o,v,h);({insert:()=>u(m,l,o),remove:()=>f(m),swap:()=>h!==void 0&&c(m,l,o,h),move:()=>h!==void 0&&d(m,l,o,h)})[v]()}function t(l,o){return`${l}[${o}]`}function e(l,o,v,h){const m=[t(l,o)];if(v==="swap")m.push(t(l,h));else if(v==="move"){const[p,M]=[Math.min(o,h),Math.max(o,h)];for(let g=p;g<=M;g++)m.push(t(l,g))}else{const p=a.getFieldValue(l),M=Array.isArray(p)?p.length:0;for(let g=o+1;g<M;g++)m.push(t(l,g))}return Object.keys(a.fieldInfo).filter(p=>m.some(M=>p.startsWith(M)))}function s(l,o){return l.replace(/\[(\d+)\]/,(v,h)=>{const m=parseInt(h,10);return`[${o==="up"?m+1:Math.max(0,m-1)}]`})}function i(l,o){(o==="up"?l:[...l].reverse()).forEach(h=>{const m=s(h.toString(),o),p=a.getFieldMeta(m);p?a.setFieldMeta(h,p):a.setFieldMeta(h,n())})}const n=()=>X,u=(l,o,v)=>{i(l,"down"),l.forEach(h=>{h.toString().startsWith(t(o,v))&&a.setFieldMeta(h,n())})},f=l=>{i(l,"up")},d=(l,o,v,h)=>{const m=new Map(Object.keys(a.fieldInfo).filter(p=>p.startsWith(t(o,v))).map(p=>[p,a.getFieldMeta(p)]));i(l,v<h?"up":"down"),Object.keys(a.fieldInfo).filter(p=>p.startsWith(t(o,h))).forEach(p=>{const M=p.replace(t(o,h),t(o,v)),g=m.get(M);g&&a.setFieldMeta(p,g)})},c=(l,o,v,h)=>{l.forEach(m=>{if(!m.toString().startsWith(t(o,v)))return;const p=m.toString().replace(t(o,v),t(o,h)),[M,g]=[a.getFieldMeta(m),a.getFieldMeta(p)];M&&a.setFieldMeta(p,M),g&&a.setFieldMeta(m,g)})};return{handleArrayFieldMetaShift:r}}function re(a){return{values:a.values??{},errorMap:a.errorMap??{},fieldMetaBase:a.fieldMetaBase??{},isSubmitted:a.isSubmitted??!1,isSubmitting:a.isSubmitting??!1,isValidating:a.isValidating??!1,submissionAttempts:a.submissionAttempts??0,isSubmitSuccessful:a.isSubmitSuccessful??!1,validationMetaMap:a.validationMetaMap??{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0}}}class xe{constructor(r){var t;this.options={},this.fieldInfo={},this.prevTransformArray=[],this.mount=()=>{var e,s;const i=this.fieldMetaDerived.mount(),n=this.store.mount(),u=()=>{i(),n()};(s=(e=this.options.listeners)==null?void 0:e.onMount)==null||s.call(e,{formApi:this});const{onMount:f}=this.options.validators||{};return f&&this.validateSync("mount"),u},this.update=e=>{var s,i;if(!e)return;const n=this.options;this.options=e;const u=!!((i=(s=e.transform)==null?void 0:s.deps)!=null&&i.some((c,l)=>c!==this.prevTransformArray[l])),f=e.defaultValues&&!T(e.defaultValues,n.defaultValues)&&!this.state.isTouched,d=!T(e.defaultState,n.defaultState)&&!this.state.isTouched;!f&&!d&&!u||O(()=>{this.baseStore.setState(()=>re(Object.assign({},this.state,d?e.defaultState:{},f?{values:e.defaultValues}:{},u?{_force_re_eval:!this.state._force_re_eval}:{})))})},this.reset=(e,s)=>{const{fieldMeta:i}=this.state,n=this.resetFieldMeta(i);e&&!s?.keepDefaultValues&&(this.options={...this.options,defaultValues:e}),this.baseStore.setState(()=>{var u;return re({...this.options.defaultState,values:e??this.options.defaultValues??((u=this.options.defaultState)==null?void 0:u.values),fieldMetaBase:n})})},this.validateAllFields=async e=>{const s=[];return O(()=>{Object.values(this.fieldInfo).forEach(n=>{if(!n.instance)return;const u=n.instance;s.push(Promise.resolve().then(()=>u.validate(e,{skipFormValidation:!0}))),n.instance.state.meta.isTouched||n.instance.setMeta(f=>({...f,isTouched:!0}))})}),(await Promise.all(s)).flat()},this.validateArrayFieldsStartingFrom=async(e,s,i)=>{const n=this.getFieldValue(e),u=Array.isArray(n)?Math.max(n.length-1,0):null,f=[`${e}[${s}]`];for(let o=s+1;o<=(u??0);o++)f.push(`${e}[${o}]`);const d=Object.keys(this.fieldInfo).filter(o=>f.some(v=>o.startsWith(v))),c=[];return O(()=>{d.forEach(o=>{c.push(Promise.resolve().then(()=>this.validateField(o,i)))})}),(await Promise.all(c)).flat()},this.validateField=(e,s)=>{var i;const n=(i=this.fieldInfo[e])==null?void 0:i.instance;return n?(n.state.meta.isTouched||n.setMeta(u=>({...u,isTouched:!0})),n.validate(s)):[]},this.validateSync=e=>{const s=de(e,this.options);let i=!1;const n={};return O(()=>{var u,f;for(const c of s){if(!c.validate)continue;const l=this.runValidator({validate:c.validate,value:{value:this.state.values,formApi:this,validationSource:"form"},type:"validate"}),{formError:o,fieldErrors:v}=J(l),h=K(c.cause);for(const m of Object.keys(this.state.fieldMeta)){const p=this.getFieldMeta(m);if(!p)continue;const{errorMap:M,errorSourceMap:g}=p,S=v?.[m],{newErrorValue:b,newSource:E}=pe({newFormValidatorError:S,isPreviousErrorFromFormValidator:g?.[h]==="form",previousErrorValue:M?.[h]});E==="form"&&(n[m]={...n[m],[h]:S}),M?.[h]!==b&&this.setFieldMeta(m,V=>({...V,errorMap:{...V.errorMap,[h]:b},errorSourceMap:{...V.errorSourceMap,[h]:E}}))}((u=this.state.errorMap)==null?void 0:u[h])!==o&&this.baseStore.setState(m=>({...m,errorMap:{...m.errorMap,[h]:o}})),(o||v)&&(i=!0)}const d=K("submit");(f=this.state.errorMap)!=null&&f[d]&&e!=="submit"&&!i&&this.baseStore.setState(c=>({...c,errorMap:{...c.errorMap,[d]:void 0}}))}),{hasErrored:i,fieldsErrorMap:n}},this.validateAsync=async e=>{const s=ce(e,this.options);this.state.isFormValidating||this.baseStore.setState(d=>({...d,isFormValidating:!0}));const i=[];let n;for(const d of s){if(!d.validate)continue;const c=K(d.cause),l=this.state.validationMetaMap[c];l?.lastAbortController.abort();const o=new AbortController;this.state.validationMetaMap[c]={lastAbortController:o},i.push(new Promise(async v=>{let h;try{h=await new Promise((g,S)=>{setTimeout(async()=>{if(o.signal.aborted)return g(void 0);try{g(await this.runValidator({validate:d.validate,value:{value:this.state.values,formApi:this,validationSource:"form",signal:o.signal},type:"validateAsync"}))}catch(b){S(b)}},d.debounceMs)})}catch(g){h=g}const{formError:m,fieldErrors:p}=J(h);p&&(n=n?{...n,...p}:p);const M=K(d.cause);for(const g of Object.keys(this.state.fieldMeta)){const S=this.getFieldMeta(g);if(!S)continue;const{errorMap:b,errorSourceMap:E}=S,V=n?.[g],{newErrorValue:w,newSource:A}=pe({newFormValidatorError:V,isPreviousErrorFromFormValidator:E?.[M]==="form",previousErrorValue:b?.[M]});b?.[M]!==w&&this.setFieldMeta(g,F=>({...F,errorMap:{...F.errorMap,[M]:w},errorSourceMap:{...F.errorSourceMap,[M]:A}}))}this.baseStore.setState(g=>({...g,errorMap:{...g.errorMap,[M]:m}})),v(n?{fieldErrors:n,errorMapKey:M}:void 0)}))}let u=[];const f={};if(i.length){u=await Promise.all(i);for(const d of u)if(d?.fieldErrors){const{errorMapKey:c}=d;for(const[l,o]of Object.entries(d.fieldErrors)){const h={...f[l]||{},[c]:o};f[l]=h}}}return this.baseStore.setState(d=>({...d,isFormValidating:!1})),f},this.validate=e=>{const{hasErrored:s,fieldsErrorMap:i}=this.validateSync(e);return s&&!this.options.asyncAlways?i:this.validateAsync(e)},this.getFieldValue=e=>$(this.state.values,e),this.getFieldMeta=e=>this.state.fieldMeta[e],this.getFieldInfo=e=>{var s;return(s=this.fieldInfo)[e]||(s[e]={instance:null,validationMetaMap:{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0}})},this.setFieldMeta=(e,s)=>{this.baseStore.setState(i=>({...i,fieldMetaBase:{...i.fieldMetaBase,[e]:Z(s,i.fieldMetaBase[e])}}))},this.resetFieldMeta=e=>Object.keys(e).reduce((s,i)=>{const n=i;return s[n]=X,s},{}),this.setFieldValue=(e,s,i)=>{const n=i?.dontUpdateMeta??!1;O(()=>{n||this.setFieldMeta(e,u=>({...u,isTouched:!0,isDirty:!0,errorMap:{...u?.errorMap,onMount:void 0}})),this.baseStore.setState(u=>({...u,values:z(u.values,e,s)}))})},this.deleteField=e=>{const i=[...Object.keys(this.fieldInfo).filter(n=>{const u=e.toString();return n!==u&&n.startsWith(u)}),e];this.baseStore.setState(n=>{const u={...n};return i.forEach(f=>{u.values=Ce(u.values,f),delete this.fieldInfo[f],delete u.fieldMetaBase[f]}),u})},this.pushFieldValue=(e,s,i)=>{this.setFieldValue(e,n=>[...Array.isArray(n)?n:[],s],i),this.validateField(e,"change")},this.insertFieldValue=async(e,s,i,n)=>{this.setFieldValue(e,u=>[...u.slice(0,s),i,...u.slice(s)],n),await this.validateField(e,"change"),G(this).handleArrayFieldMetaShift(e,s,"insert"),await this.validateArrayFieldsStartingFrom(e,s,"change")},this.replaceFieldValue=async(e,s,i,n)=>{this.setFieldValue(e,u=>u.map((f,d)=>d===s?i:f),n),await this.validateField(e,"change"),await this.validateArrayFieldsStartingFrom(e,s,"change")},this.removeFieldValue=async(e,s,i)=>{const n=this.getFieldValue(e),u=Array.isArray(n)?Math.max(n.length-1,0):null;if(this.setFieldValue(e,f=>f.filter((d,c)=>c!==s),i),G(this).handleArrayFieldMetaShift(e,s,"remove"),u!==null){const f=`${e}[${u}]`;this.deleteField(f)}await this.validateField(e,"change"),await this.validateArrayFieldsStartingFrom(e,s,"change")},this.swapFieldValues=(e,s,i,n)=>{this.setFieldValue(e,u=>{const f=u[s],d=u[i];return z(z(u,`${s}`,d),`${i}`,f)},n),G(this).handleArrayFieldMetaShift(e,s,"swap",i),this.validateField(e,"change"),this.validateField(`${e}[${s}]`,"change"),this.validateField(`${e}[${i}]`,"change")},this.moveFieldValues=(e,s,i,n)=>{this.setFieldValue(e,u=>(u.splice(i,0,u.splice(s,1)[0]),u),n),G(this).handleArrayFieldMetaShift(e,s,"move",i),this.validateField(e,"change"),this.validateField(`${e}[${s}]`,"change"),this.validateField(`${e}[${i}]`,"change")},this.clearFieldValues=(e,s)=>{const i=this.getFieldValue(e),n=Array.isArray(i)?Math.max(i.length-1,0):null;if(this.setFieldValue(e,[],s),n!==null)for(let u=0;u<=n;u++){const f=`${e}[${u}]`;this.deleteField(f)}this.validateField(e,"change")},this.resetField=e=>{this.baseStore.setState(s=>({...s,fieldMetaBase:{...s.fieldMetaBase,[e]:X},values:this.options.defaultValues?z(s.values,e,$(this.options.defaultValues,e)):s.values}))},this.getAllErrors=()=>({form:{errors:this.state.errors,errorMap:this.state.errorMap},fields:Object.entries(this.state.fieldMeta).reduce((e,[s,i])=>(Object.keys(i).length&&i.errors.length&&(e[s]={errors:i.errors,errorMap:i.errorMap}),e),{})}),this.parseValuesWithSchema=e=>C.validate({value:this.state.values,validationSource:"form"},e),this.parseValuesWithSchemaAsync=e=>C.validateAsync({value:this.state.values,validationSource:"form"},e),this.baseStore=new le(re({...r?.defaultState,values:r?.defaultValues??((t=r?.defaultState)==null?void 0:t.values)})),this.fieldMetaDerived=new k({deps:[this.baseStore],fn:({prevDepVals:e,currDepVals:s,prevVal:i})=>{var n,u,f;const d=i,c=e?.[0],l=s[0];let o=0;const v={};for(const h of Object.keys(l.fieldMetaBase)){const m=l.fieldMetaBase[h],p=c?.fieldMetaBase[h],M=d?.[h],g=$(l.values,h);let S=M?.errors;if(!p||m.errorMap!==p.errorMap){S=Object.values(m.errorMap??{}).filter(A=>A!==void 0);const w=(n=this.getFieldInfo(h))==null?void 0:n.instance;w&&!w.options.disableErrorFlat&&(S=S?.flat(1))}const b=!We(S??[]),E=!m.isDirty,V=T(g,$(this.options.defaultValues,h))||T(g,(f=(u=this.getFieldInfo(h))==null?void 0:u.instance)==null?void 0:f.options.defaultValue);if(M&&M.isPristine===E&&M.isValid===b&&M.isDefaultValue===V&&M.errors===S&&m===p){v[h]=M,o++;continue}v[h]={...m,errors:S,isPristine:E,isValid:b,isDefaultValue:V}}return Object.keys(l.fieldMetaBase).length&&d&&o===Object.keys(l.fieldMetaBase).length?d:v}}),this.store=new k({deps:[this.baseStore,this.fieldMetaDerived],fn:({prevDepVals:e,currDepVals:s,prevVal:i})=>{var n,u,f,d;const c=i,l=e?.[0],o=s[0],v=s[1],h=Object.values(v).filter(Boolean),m=h.some(y=>y.isValidating),p=h.every(y=>y.isValid),M=h.some(y=>y.isTouched),g=h.some(y=>y.isBlurred),S=h.every(y=>y.isDefaultValue),b=M&&((n=o.errorMap)==null?void 0:n.onMount),E=h.some(y=>y.isDirty),V=!E,w=!!((u=o.errorMap)!=null&&u.onMount||h.some(y=>{var D;return(D=y?.errorMap)==null?void 0:D.onMount})),A=!!m;let F=c?.errors??[];(!l||o.errorMap!==l.errorMap)&&(F=Object.values(o.errorMap).reduce((y,D)=>D===void 0?y:D&&he(D)?(y.push(D.form),y):(y.push(D),y),[]));const L=F.length===0,P=p&&L,ke=this.options.canSubmitWhenInvalid??!1,me=o.submissionAttempts===0&&!M&&!w||!A&&!o.isSubmitting&&P||ke;let R=o.errorMap;if(b&&(F=F.filter(y=>y!==o.errorMap.onMount),R=Object.assign(R,{onMount:void 0})),c&&l&&c.errorMap===R&&c.fieldMeta===this.fieldMetaDerived.state&&c.errors===F&&c.isFieldsValidating===m&&c.isFieldsValid===p&&c.isFormValid===L&&c.isValid===P&&c.canSubmit===me&&c.isTouched===M&&c.isBlurred===g&&c.isPristine===V&&c.isDefaultValue===S&&c.isDirty===E&&T(l,o))return c;let ee={...o,errorMap:R,fieldMeta:this.fieldMetaDerived.state,errors:F,isFieldsValidating:m,isFieldsValid:p,isFormValid:L,isValid:P,canSubmit:me,isTouched:M,isBlurred:g,isPristine:V,isDefaultValue:S,isDirty:E};const te=((f=this.options.transform)==null?void 0:f.deps)??[];if(te.length!==this.prevTransformArray.length||te.some((y,D)=>y!==this.prevTransformArray[D])){const y=Object.assign({},this,{state:ee});(d=this.options.transform)==null||d.fn(y),ee=y.state,this.prevTransformArray=te}return ee}}),this.handleSubmit=this.handleSubmit.bind(this),this.update(r||{})}get state(){return this.store.state}runValidator(r){return De(r.validate)?C[r.type](r.value,r.validate):r.validate(r.value)}async handleSubmit(r){var t,e,s,i,n,u,f,d;if(this.baseStore.setState(l=>({...l,isSubmitted:!1,submissionAttempts:l.submissionAttempts+1,isSubmitSuccessful:!1})),O(()=>{Object.values(this.fieldInfo).forEach(l=>{l.instance&&(l.instance.state.meta.isTouched||l.instance.setMeta(o=>({...o,isTouched:!0})))})}),!this.state.canSubmit)return;this.baseStore.setState(l=>({...l,isSubmitting:!0}));const c=()=>{this.baseStore.setState(l=>({...l,isSubmitting:!1}))};if(await this.validateAllFields("submit"),!this.state.isFieldsValid){c(),(e=(t=this.options).onSubmitInvalid)==null||e.call(t,{value:this.state.values,formApi:this});return}if(await this.validate("submit"),!this.state.isValid){c(),(i=(s=this.options).onSubmitInvalid)==null||i.call(s,{value:this.state.values,formApi:this});return}O(()=>{Object.values(this.fieldInfo).forEach(l=>{var o,v,h;(h=(v=(o=l.instance)==null?void 0:o.options.listeners)==null?void 0:v.onSubmit)==null||h.call(v,{value:l.instance.state.value,fieldApi:l.instance})})}),(u=(n=this.options.listeners)==null?void 0:n.onSubmit)==null||u.call(n,{formApi:this});try{await((d=(f=this.options).onSubmit)==null?void 0:d.call(f,{value:this.state.values,formApi:this,meta:r??this.options.onSubmitMeta})),O(()=>{this.baseStore.setState(l=>({...l,isSubmitted:!0,isSubmitSuccessful:!0})),c()})}catch(l){throw this.baseStore.setState(o=>({...o,isSubmitSuccessful:!1})),c(),l}}setErrorMap(r){O(()=>{Object.entries(r).forEach(([t,e])=>{const s=t;if(he(e)){const{formError:i,fieldErrors:n}=J(e);for(const u of Object.keys(this.fieldInfo))this.getFieldMeta(u)&&this.setFieldMeta(u,d=>({...d,errorMap:{...d.errorMap,[s]:n?.[u]},errorSourceMap:{...d.errorSourceMap,[s]:"form"}}));this.baseStore.setState(u=>({...u,errorMap:{...u.errorMap,[s]:i}}))}else this.baseStore.setState(i=>({...i,errorMap:{...i.errorMap,[s]:e}}))})})}}function J(a){if(a){if(he(a)){const r=J(a.form).formError,t=a.fields;return{formError:r,fieldErrors:t}}return{formError:a}}return{formError:void 0}}function K(a){switch(a){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"change":default:return"onChange"}}class ze{constructor(r){this.options={},this.mount=()=>{var t,e;const s=this.store.mount();this.options.defaultValue!==void 0&&this.form.setFieldValue(this.name,this.options.defaultValue,{dontUpdateMeta:!0});const i=this.getInfo();i.instance=this,this.update(this.options);const{onMount:n}=this.options.validators||{};if(n){const u=this.runValidator({validate:n,value:{value:this.state.value,fieldApi:this,validationSource:"field"},type:"validate"});u&&this.setMeta(f=>({...f,errorMap:{...f?.errorMap,onMount:u},errorSourceMap:{...f?.errorSourceMap,onMount:"field"}}))}return(e=(t=this.options.listeners)==null?void 0:t.onMount)==null||e.call(t,{value:this.state.value,fieldApi:this}),s},this.update=t=>{this.options=t;const e=this.name!==t.name;if(this.name=t.name,this.state.value===void 0){const s=$(t.form.options.defaultValues,t.name),i=t.defaultValue??s;e?this.setValue(n=>n||i,{dontUpdateMeta:!0}):i!==void 0&&this.setValue(i,{dontUpdateMeta:!0})}this.form.getFieldMeta(this.name)===void 0&&this.setMeta(this.state.meta)},this.getValue=()=>this.form.getFieldValue(this.name),this.setValue=(t,e)=>{this.form.setFieldValue(this.name,t,e),this.triggerOnChangeListener(),this.validate("change")},this.getMeta=()=>this.store.state.meta,this.setMeta=t=>this.form.setFieldMeta(this.name,t),this.getInfo=()=>this.form.getFieldInfo(this.name),this.pushValue=(t,e)=>{this.form.pushFieldValue(this.name,t,e),this.triggerOnChangeListener()},this.insertValue=(t,e,s)=>{this.form.insertFieldValue(this.name,t,e,s),this.triggerOnChangeListener()},this.replaceValue=(t,e,s)=>{this.form.replaceFieldValue(this.name,t,e,s),this.triggerOnChangeListener()},this.removeValue=(t,e)=>{this.form.removeFieldValue(this.name,t,e),this.triggerOnChangeListener()},this.swapValues=(t,e,s)=>{this.form.swapFieldValues(this.name,t,e,s),this.triggerOnChangeListener()},this.moveValue=(t,e,s)=>{this.form.moveFieldValues(this.name,t,e,s),this.triggerOnChangeListener()},this.clearValues=t=>{this.form.clearFieldValues(this.name,t),this.triggerOnChangeListener()},this.getLinkedFields=t=>{const e=Object.values(this.form.fieldInfo),s=[];for(const i of e){if(!i.instance)continue;const{onChangeListenTo:n,onBlurListenTo:u}=i.instance.options.validators||{};t==="change"&&n?.includes(this.name)&&s.push(i.instance),t==="blur"&&u?.includes(this.name)&&s.push(i.instance)}return s},this.validateSync=(t,e)=>{var s;const i=de(t,this.options),u=this.getLinkedFields(t).reduce((c,l)=>{const o=de(t,l.options);return o.forEach(v=>{v.field=l}),c.concat(o)},[]);let f=!1;O(()=>{const c=(l,o)=>{var v;const h=N(o.cause),m=o.validate?Se(l.runValidator({validate:o.validate,value:{value:l.store.state.value,validationSource:"field",fieldApi:l},type:"validate"})):void 0,p=e[h],{newErrorValue:M,newSource:g}=Me({formLevelError:p,fieldLevelError:m});((v=l.state.meta.errorMap)==null?void 0:v[h])!==M&&l.setMeta(S=>({...S,errorMap:{...S.errorMap,[h]:M},errorSourceMap:{...S.errorSourceMap,[h]:g}})),M&&(f=!0)};for(const l of i)c(this,l);for(const l of u)l.validate&&c(l.field,l)});const d=N("submit");return(s=this.state.meta.errorMap)!=null&&s[d]&&t!=="submit"&&!f&&this.setMeta(c=>({...c,errorMap:{...c.errorMap,[d]:void 0},errorSourceMap:{...c.errorSourceMap,[d]:void 0}})),{hasErrored:f}},this.validateAsync=async(t,e)=>{const s=ce(t,this.options),i=await e,n=this.getLinkedFields(t),u=n.reduce((o,v)=>{const h=ce(t,v.options);return h.forEach(m=>{m.field=v}),o.concat(h)},[]);this.state.meta.isValidating||this.setMeta(o=>({...o,isValidating:!0}));for(const o of n)o.setMeta(v=>({...v,isValidating:!0}));const f=[],d=[],c=(o,v,h)=>{const m=N(v.cause),p=o.getInfo().validationMetaMap[m];p?.lastAbortController.abort();const M=new AbortController;this.getInfo().validationMetaMap[m]={lastAbortController:M},h.push(new Promise(async g=>{var S;let b;try{b=await new Promise((F,L)=>{this.timeoutIds.validations[v.cause]&&clearTimeout(this.timeoutIds.validations[v.cause]),this.timeoutIds.validations[v.cause]=setTimeout(async()=>{if(M.signal.aborted)return F(void 0);try{F(await this.runValidator({validate:v.validate,value:{value:o.store.state.value,fieldApi:o,signal:M.signal,validationSource:"field"},type:"validateAsync"}))}catch(P){L(P)}},v.debounceMs)})}catch(F){b=F}if(M.signal.aborted)return g(void 0);const E=Se(b),V=(S=i[this.name])==null?void 0:S[m],{newErrorValue:w,newSource:A}=Me({formLevelError:V,fieldLevelError:E});o.setMeta(F=>({...F,errorMap:{...F?.errorMap,[m]:w},errorSourceMap:{...F.errorSourceMap,[m]:A}})),g(w)}))};for(const o of s)o.validate&&c(this,o,f);for(const o of u)o.validate&&c(o.field,o,d);let l=[];(f.length||d.length)&&(l=await Promise.all(f),await Promise.all(d)),this.setMeta(o=>({...o,isValidating:!1}));for(const o of n)o.setMeta(v=>({...v,isValidating:!1}));return l.filter(Boolean)},this.validate=(t,e)=>{var s;if(!this.state.meta.isTouched)return[];const{fieldsErrorMap:i}=e?.skipFormValidation?{fieldsErrorMap:{}}:this.form.validateSync(t),{hasErrored:n}=this.validateSync(t,i[this.name]??{});if(n&&!this.options.asyncAlways)return(s=this.getInfo().validationMetaMap[N(t)])==null||s.lastAbortController.abort(),this.state.meta.errors;const u=e?.skipFormValidation?Promise.resolve({}):this.form.validateAsync(t);return this.validateAsync(t,u)},this.handleChange=t=>{this.setValue(t)},this.handleBlur=()=>{this.state.meta.isTouched||(this.setMeta(e=>({...e,isTouched:!0})),this.validate("change")),this.state.meta.isBlurred||this.setMeta(e=>({...e,isBlurred:!0})),this.validate("blur"),this.triggerOnBlurListener()},this.parseValueWithSchema=t=>C.validate({value:this.state.value,validationSource:"field"},t),this.parseValueWithSchemaAsync=t=>C.validateAsync({value:this.state.value,validationSource:"field"},t),this.form=r.form,this.name=r.name,this.timeoutIds={validations:{},listeners:{},formListeners:{}},this.store=new k({deps:[this.form.store],fn:()=>{const t=this.form.getFieldValue(this.name),e=this.form.getFieldMeta(this.name)??{...X,...r.defaultMeta};return{value:t,meta:e}}}),this.options=r}get state(){return this.store.state}runValidator(r){return De(r.validate)?C[r.type](r.value,r.validate):r.validate(r.value)}setErrorMap(r){this.setMeta(t=>({...t,errorMap:{...t.errorMap,...r}}))}triggerOnBlurListener(){var r,t,e,s,i,n;const u=(r=this.form.options.listeners)==null?void 0:r.onBlurDebounceMs;u&&u>0?(this.timeoutIds.formListeners.blur&&clearTimeout(this.timeoutIds.formListeners.blur),this.timeoutIds.formListeners.blur=setTimeout(()=>{var d,c;(c=(d=this.form.options.listeners)==null?void 0:d.onBlur)==null||c.call(d,{formApi:this.form,fieldApi:this})},u)):(e=(t=this.form.options.listeners)==null?void 0:t.onBlur)==null||e.call(t,{formApi:this.form,fieldApi:this});const f=(s=this.options.listeners)==null?void 0:s.onBlurDebounceMs;f&&f>0?(this.timeoutIds.listeners.blur&&clearTimeout(this.timeoutIds.listeners.blur),this.timeoutIds.listeners.blur=setTimeout(()=>{var d,c;(c=(d=this.options.listeners)==null?void 0:d.onBlur)==null||c.call(d,{value:this.state.value,fieldApi:this})},f)):(n=(i=this.options.listeners)==null?void 0:i.onBlur)==null||n.call(i,{value:this.state.value,fieldApi:this})}triggerOnChangeListener(){var r,t,e,s,i,n;const u=(r=this.form.options.listeners)==null?void 0:r.onChangeDebounceMs;u&&u>0?(this.timeoutIds.formListeners.blur&&clearTimeout(this.timeoutIds.formListeners.blur),this.timeoutIds.formListeners.blur=setTimeout(()=>{var d,c;(c=(d=this.form.options.listeners)==null?void 0:d.onChange)==null||c.call(d,{formApi:this.form,fieldApi:this})},u)):(e=(t=this.form.options.listeners)==null?void 0:t.onChange)==null||e.call(t,{formApi:this.form,fieldApi:this});const f=(s=this.options.listeners)==null?void 0:s.onChangeDebounceMs;f&&f>0?(this.timeoutIds.listeners.change&&clearTimeout(this.timeoutIds.listeners.change),this.timeoutIds.listeners.change=setTimeout(()=>{var d,c;(c=(d=this.options.listeners)==null?void 0:d.onChange)==null||c.call(d,{value:this.state.value,fieldApi:this})},f)):(n=(i=this.options.listeners)==null?void 0:i.onChange)==null||n.call(i,{value:this.state.value,fieldApi:this})}}function Se(a){if(a)return a}function N(a){switch(a){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"change":default:return"onChange"}}var ie={exports:{}},ae={},ne={exports:{}},oe={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ye;function Ue(){if(ye)return oe;ye=1;var a=Ee();function r(l,o){return l===o&&(l!==0||1/l===1/o)||l!==l&&o!==o}var t=typeof Object.is=="function"?Object.is:r,e=a.useState,s=a.useEffect,i=a.useLayoutEffect,n=a.useDebugValue;function u(l,o){var v=o(),h=e({inst:{value:v,getSnapshot:o}}),m=h[0].inst,p=h[1];return i(function(){m.value=v,m.getSnapshot=o,f(m)&&p({inst:m})},[l,v,o]),s(function(){return f(m)&&p({inst:m}),l(function(){f(m)&&p({inst:m})})},[l]),n(v),v}function f(l){var o=l.getSnapshot;l=l.value;try{var v=o();return!t(l,v)}catch{return!0}}function d(l,o){return o()}var c=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?d:u;return oe.useSyncExternalStore=a.useSyncExternalStore!==void 0?a.useSyncExternalStore:c,oe}var be;function Ge(){return be||(be=1,ne.exports=Ue()),ne.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ve;function Ke(){if(Ve)return ae;Ve=1;var a=Ee(),r=Ge();function t(d,c){return d===c&&(d!==0||1/d===1/c)||d!==d&&c!==c}var e=typeof Object.is=="function"?Object.is:t,s=r.useSyncExternalStore,i=a.useRef,n=a.useEffect,u=a.useMemo,f=a.useDebugValue;return ae.useSyncExternalStoreWithSelector=function(d,c,l,o,v){var h=i(null);if(h.current===null){var m={hasValue:!1,value:null};h.current=m}else m=h.current;h=u(function(){function M(V){if(!g){if(g=!0,S=V,V=o(V),v!==void 0&&m.hasValue){var w=m.value;if(v(w,V))return b=w}return b=V}if(w=b,e(S,V))return w;var A=o(V);return v!==void 0&&v(w,A)?(S=V,w):(S=V,b=A)}var g=!1,S,b,E=l===void 0?null:l;return[function(){return M(c())},E===null?void 0:function(){return M(E())}]},[c,l,o,v]);var p=s(d,h[0],h[1]);return n(function(){m.hasValue=!0,m.value=p},[p]),f(p),p},ae}var Fe;function Ne(){return Fe||(Fe=1,ie.exports=Ke()),ie.exports}var qe=Ne();function ve(a,r=t=>t){return qe.useSyncExternalStoreWithSelector(a.subscribe,()=>a.state,()=>a.state,r,He)}function He(a,r){if(Object.is(a,r))return!0;if(typeof a!="object"||a===null||typeof r!="object"||r===null)return!1;if(a instanceof Map&&r instanceof Map){if(a.size!==r.size)return!1;for(const[e,s]of a)if(!r.has(e)||!Object.is(s,r.get(e)))return!1;return!0}if(a instanceof Set&&r instanceof Set){if(a.size!==r.size)return!1;for(const e of a)if(!r.has(e))return!1;return!0}const t=Object.keys(a);if(t.length!==Object.keys(r).length)return!1;for(let e=0;e<t.length;e++)if(!Object.prototype.hasOwnProperty.call(r,t[e])||!Object.is(a[t[e]],r[t[e]]))return!1;return!0}const Y=typeof window<"u"?W.useLayoutEffect:W.useEffect;function Je(a){const[r]=W.useState(()=>{const e=new ze({...a,form:a.form,name:a.name});return e.Field=Oe,e});return Y(r.mount,[r]),Y(()=>{r.update(a)}),ve(r.store,a.mode==="array"?t=>[t.meta,Object.keys(t.value??[]).length]:void 0),r}const Oe=({children:a,...r})=>{const t=Je(r),e=W.useMemo(()=>Z(a,t),[a,t,t.state.value,t.state.meta]);return _.jsx(_.Fragment,{children:e})};function Qe({form:a,selector:r,children:t}){const e=ve(a.store,r);return Z(t,e)}function Xe(a){const[r]=W.useState(()=>{const t=new xe(a),e=t;return e.Field=function(i){return _.jsx(Oe,{...i,form:t})},e.Subscribe=s=>_.jsx(Qe,{form:t,selector:s.selector,children:s.children}),e});return Y(r.mount,[]),ve(r.store,t=>t.isSubmitting),Y(()=>{r.update(a)}),r}const at={component:we},Ye={width:"600px",height:"400px"},q={name:"With Tanstack Form",render:()=>{const a=Xe({defaultValues:{text:"Hello tanstack"},onSubmit:r=>alert(JSON.stringify(r.value))});return _.jsxs("form",{onSubmit:r=>{r.preventDefault(),r.stopPropagation(),a.handleSubmit()},children:[_.jsx(a.Field,{name:"text",validators:{onChange:({value:r})=>{if(!r)return"This field is required";if(!r.toLowerCase().includes("tanstack"))return"Text must include tanstack"}},children:r=>_.jsxs(_.Fragment,{children:[_.jsx(we,{style:Ye,name:r.name,value:r.state.value,onChange:t=>r.handleChange(t.target.value),onBlur:r.handleBlur,children:t=>t.split("").map((e,s)=>_.jsx("span",{style:{color:"tanstack".includes(e.toLowerCase())?"tan":void 0},children:e},s))}),r.state.meta.errors&&_.jsx("span",{style:{color:"red"},children:r.state.meta.errors.join(", ")})]})}),_.jsx("button",{type:"submit",children:"submit"})]})}};q.parameters={...q.parameters,docs:{...q.parameters?.docs,source:{originalSource:`{
  name: "With Tanstack Form",
  render: () => {
    const form = useForm({
      defaultValues: {
        text: "Hello tanstack"
      },
      onSubmit: data => alert(JSON.stringify(data.value))
    });
    return <form onSubmit={e => {
      e.preventDefault();
      e.stopPropagation();
      form.handleSubmit();
    }}>
        <form.Field name="text" validators={{
        onChange: ({
          value
        }) => {
          if (!value) {
            return "This field is required";
          }
          if (!value.toLowerCase().includes("tanstack")) {
            return "Text must include tanstack";
          }
        }
      }}>
          {field => <>
              <RichTextarea style={style} name={field.name} value={field.state.value} onChange={e => field.handleChange(e.target.value)} onBlur={field.handleBlur}>
                {v => {
              return v.split("").map((t, i) => <span key={i} style={{
                color: "tanstack".includes(t.toLowerCase()) ? "tan" : undefined
              }}>
                      {t}
                    </span>);
            }}
              </RichTextarea>
              {field.state.meta.errors && <span style={{
            color: "red"
          }}>
                  {field.state.meta.errors.join(", ")}
                </span>}
            </>}
        </form.Field>
        <button type="submit">submit</button>
      </form>;
  }
}`,...q.parameters?.docs?.source}}};const nt=["Default"];export{q as Default,nt as __namedExportsOrder,at as default};
