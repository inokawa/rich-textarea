import{j as m,s as f,C as W,u as F,r as o,a as T,c as L,b as N,R as V,h as w,d as $}from"./observer-Djkfms2H.js";import{r as n}from"./index-RYns6xqu.js";const q=n.memo(({_ref:b,_handle:E,_render:s,_width:c})=>{const[r,h]=n.useState("");return n.useImperativeHandle(E,()=>h,[]),m.jsxs("div",{ref:b,"aria-hidden":!0,style:n.useMemo(()=>({width:c,transform:"translate(0px, 0px)",pointerEvents:"none",userSelect:"none",msUserSelect:"none",WebkitUserSelect:"none",boxSizing:"content-box",textSizeAdjust:"100%",WebkitTextSizeAdjust:"100%",MozTextSizeAdjust:"100%"}),[c]),onClick:f,onMouseDown:f,onMouseUp:f,onMouseOver:f,onMouseOut:f,onMouseMove:f,children:[n.useMemo(()=>s?s(r):r,[r,s]),W]})}),G=n.forwardRef(({children:b,autoHeight:E,style:s,onChange:c,onKeyDown:r,onSelectionChange:h,...k},A)=>{const u=n.useRef(null),v=n.useRef(null),x=n.useRef(null),[[_,C,z,P],I]=n.useState([0,0,0,0]),[M,H]=n.useState(!1),O=n.useRef(""),[[d,S],U]=n.useState([null,null]),R=F(()=>$(u,U)),p=_+z,g=C+P,j=!!(p+g);return n.useImperativeHandle(A,()=>{const e=u[o],t={get selectionStart(){return R._getSelectionStart()},get selectionEnd(){return R._getSelectionEnd()},setRangeText(l,i,a,B){e.setRangeText?e.setRangeText(l,i,a,B):(e.focus(),e.selectionStart=i,e.selectionEnd=a,document.execCommand("insertText",!1,l)),e.dispatchEvent(new Event("input",{bubbles:!0}))}};return new Proxy(e,{get(l,i){if(t[i])return t[i];const a=l[i];return typeof a=="function"?a.bind(l):a},set(l,i,a){return l[i]=a,!0}})},[]),T(()=>{const e=u[o],t=v[o];if(!(!e||!t))return L(e,t,R,I,H)},[]),T(()=>{const e=u[o];e&&x[o](e.value)},[k.value]),T(()=>{const e=u[o],t=v[o];!t||!e||N(e,t,O,s)},[s]),n.useEffect(()=>{if(!(d==null||S==null||!h))if(!M)h({focused:!1,selectionStart:d,selectionEnd:S});else{const t=V(v[o],d,d+1).getBoundingClientRect();h({focused:!0,top:t.top,left:t.left,height:t.height,selectionStart:d,selectionEnd:S})}},[M,d,S]),n.useEffect(()=>{const e=u[o];!E||!e||(e.style.height="auto",e.style.height=`${e.scrollHeight}px`)}),m.jsxs("div",{style:n.useMemo(()=>{let e=p,t=g;return s&&(w(s.width)&&(e=s.width),w(s.height)&&(t=s.height)),{display:"inline-block",position:"relative",width:e,height:t}},[p,g,s]),children:[m.jsx("div",{style:n.useMemo(()=>{const e={position:"absolute",overflow:"hidden",top:0,left:0,width:p,height:g};return s&&["background","backgroundColor"].forEach(t=>{s[t]&&(e[t]=s[t])}),e},[p,g,s]),children:m.jsx(q,{_ref:v,_handle:x,_render:b,_width:_})}),m.jsx("textarea",{...k,ref:u,style:n.useMemo(()=>({...s,background:"transparent",margin:0,position:"absolute",...!j&&{position:void 0,verticalAlign:"top"}}),[s,j]),onChange:n.useCallback(e=>{var t;(t=x[o])==null||t.call(x,e.target.value),c==null||c(e)},[c]),onKeyDown:n.useCallback(e=>{e.nativeEvent.isComposing||e.nativeEvent.keyCode===229||(r==null||r(e),R._updateSeletion())},[r])})]})});G.__docgenInfo={description:"Textarea component with some extra props. See {@link RichTextareaProps} and {@link RichTextareaHandle}.",methods:[],displayName:"RichTextarea"};export{G as R};
