import{j as E}from"./observer-B5GHaPvN.js";import{r as T}from"./index-RYns6xqu.js";import{R as Ve}from"./textarea-DZOz3AQ5.js";const C=new WeakMap,Q=new WeakMap,Y={current:[]};let re=!1,x=0;const j=new Set,z=new Map;function Fe(r){const i=Array.from(r).sort((t,e)=>t instanceof O&&t.options.deps.includes(e)?1:e instanceof O&&e.options.deps.includes(t)?-1:0);for(const t of i){if(Y.current.includes(t))continue;Y.current.push(t),t.recompute();const e=Q.get(t);if(e)for(const s of e){const a=C.get(s);a&&Fe(a)}}}function Ie(r){r.listeners.forEach(i=>i({prevVal:r.prevState,currentVal:r.state}))}function Ce(r){r.listeners.forEach(i=>i({prevVal:r.prevState,currentVal:r.state}))}function we(r){if(x>0&&!z.has(r)&&z.set(r,r.prevState),j.add(r),!(x>0)&&!re)try{for(re=!0;j.size>0;){const i=Array.from(j);j.clear();for(const t of i){const e=z.get(t)??t.prevState;t.prevState=e,Ie(t)}for(const t of i){const e=C.get(t);e&&(Y.current.push(t),Fe(e))}for(const t of i){const e=C.get(t);if(e)for(const s of e)Ce(s)}}}finally{re=!1,Y.current=[],z.clear()}}function D(r){x++;try{r()}finally{if(x--,x===0){const i=Array.from(j)[0];i&&we(i)}}}function Le(r){return typeof r=="function"}class oe{constructor(i,t){this.listeners=new Set,this.subscribe=e=>{var s,a;this.listeners.add(e);const n=(a=(s=this.options)==null?void 0:s.onSubscribe)==null?void 0:a.call(s,e,this);return()=>{this.listeners.delete(e),n==null||n()}},this.prevState=i,this.state=i,this.options=t}setState(i){var t,e,s;this.prevState=this.state,(t=this.options)!=null&&t.updateFn?this.state=this.options.updateFn(this.prevState)(i):Le(i)?this.state=i(this.prevState):this.state=i,(s=(e=this.options)==null?void 0:e.onUpdate)==null||s.call(e),we(this)}}class O{constructor(i){this.listeners=new Set,this._subscriptions=[],this.lastSeenDepValues=[],this.getDepVals=()=>{const t=[],e=[];for(const s of this.options.deps)t.push(s.prevState),e.push(s.state);return this.lastSeenDepValues=e,{prevDepVals:t,currDepVals:e,prevVal:this.prevState??void 0}},this.recompute=()=>{var t,e;this.prevState=this.state;const{prevDepVals:s,currDepVals:a,prevVal:n}=this.getDepVals();this.state=this.options.fn({prevDepVals:s,currDepVals:a,prevVal:n}),(e=(t=this.options).onUpdate)==null||e.call(t)},this.checkIfRecalculationNeededDeeply=()=>{for(const a of this.options.deps)a instanceof O&&a.checkIfRecalculationNeededDeeply();let t=!1;const e=this.lastSeenDepValues,{currDepVals:s}=this.getDepVals();for(let a=0;a<s.length;a++)if(s[a]!==e[a]){t=!0;break}t&&this.recompute()},this.mount=()=>(this.registerOnGraph(),this.checkIfRecalculationNeededDeeply(),()=>{this.unregisterFromGraph();for(const t of this._subscriptions)t()}),this.subscribe=t=>{var e,s;this.listeners.add(t);const a=(s=(e=this.options).onSubscribe)==null?void 0:s.call(e,t,this);return()=>{this.listeners.delete(t),a==null||a()}},this.options=i,this.state=i.fn({prevDepVals:void 0,prevVal:void 0,currDepVals:this.getDepVals().currDepVals})}registerOnGraph(i=this.options.deps){for(const t of i)if(t instanceof O)t.registerOnGraph(),this.registerOnGraph(t.options.deps);else if(t instanceof oe){let e=C.get(t);e||(e=new Set,C.set(t,e)),e.add(this);let s=Q.get(this);s||(s=new Set,Q.set(this,s)),s.add(t)}}unregisterFromGraph(i=this.options.deps){for(const t of i)if(t instanceof O)this.unregisterFromGraph(t.options.deps);else if(t instanceof oe){const e=C.get(t);e&&e.delete(this);const s=Q.get(this);s&&s.delete(t)}}}function ee(r,i){return typeof r=="function"?r(i):r}function W(r,i){return he(i).reduce((e,s)=>{if(e===null)return null;if(typeof e<"u")return e[s]},r)}function U(r,i,t){const e=he(i);function s(a){if(!e.length)return ee(t,a);const n=e.shift();if(typeof n=="string"||typeof n=="number"&&!Array.isArray(a))return typeof a=="object"?(a===null&&(a={}),{...a,[n]:s(a[n])}):{[n]:s()};if(Array.isArray(a)&&typeof n=="number"){const o=a.slice(0,n);return[...o.length?o:new Array(n),s(a[n]),...a.slice(n+1)]}return[...new Array(n),s()]}return s(r)}function $e(r,i){const t=he(i);function e(s){if(!s)return;if(t.length===1){const n=t[0];if(Array.isArray(s)&&typeof n=="number")return s.filter((d,c)=>c!==n);const{[n]:o,...f}=s;return f}const a=t.shift();if(typeof a=="string"&&typeof s=="object")return{...s,[a]:e(s[a])};if(typeof a=="number"&&Array.isArray(s)){if(a>=s.length)return s;const n=s.slice(0,a);return[...n.length?n:new Array(a),e(s[a]),...s.slice(a+1)]}throw new Error("It seems we have created an infinite loop in deleteBy. ")}return e(r)}const Pe=/^(\d+)$/gm,Be=/\.(\d+)(?=\.)/gm,je=/^(\d+)\./gm,We=/\.(\d+$)/gm,xe=/\.{2,}/gm,le="__int__",G=`${le}$1`;function he(r){if(Array.isArray(r))return[...r];if(typeof r!="string")throw new Error("Path must be a string.");return r.replace(/(^\[)|]/gm,"").replace(/\[/g,".").replace(Pe,G).replace(Be,`.${G}.`).replace(je,`${G}.`).replace(We,`.${G}`).replace(xe,".").split(".").map(i=>i.indexOf(le)===0?parseInt(i.substring(le.length),10):i)}function Re(r){return!(Array.isArray(r)&&r.length===0)}function ue(r,i){const{asyncDebounceMs:t}=i,{onChangeAsync:e,onBlurAsync:s,onSubmitAsync:a,onBlurAsyncDebounceMs:n,onChangeAsyncDebounceMs:o}=i.validators||{},f=t??0,d={cause:"change",validate:e,debounceMs:o??f},c={cause:"blur",validate:s,debounceMs:n??f},u={cause:"submit",validate:a,debounceMs:0},l=v=>({...v,debounceMs:0});switch(r){case"submit":return[l(d),l(c),u];case"blur":return[c];case"change":return[d];case"server":default:return[]}}function ce(r,i){const{onChange:t,onBlur:e,onSubmit:s,onMount:a}=i.validators||{},n={cause:"change",validate:t},o={cause:"blur",validate:e},f={cause:"submit",validate:s},d={cause:"mount",validate:a},c={cause:"server",validate:()=>{}};switch(r){case"mount":return[d];case"submit":return[n,o,f,c];case"server":return[c];case"blur":return[o,c];case"change":default:return[n,c]}}const de=r=>!!r&&typeof r=="object"&&"fields"in r;function I(r,i){if(Object.is(r,i))return!0;if(typeof r!="object"||r===null||typeof i!="object"||i===null)return!1;if(r instanceof Map&&i instanceof Map){if(r.size!==i.size)return!1;for(const[s,a]of r)if(!i.has(s)||!Object.is(a,i.get(s)))return!1;return!0}if(r instanceof Set&&i instanceof Set){if(r.size!==i.size)return!1;for(const s of r)if(!i.has(s))return!1;return!0}const t=Object.keys(r),e=Object.keys(i);if(t.length!==e.length)return!1;for(const s of t)if(!e.includes(s)||!I(r[s],i[s]))return!1;return!0}const me=({newFormValidatorError:r,isPreviousErrorFromFormValidator:i,previousErrorValue:t})=>r?{newErrorValue:r,newSource:"form"}:i?{newErrorValue:void 0,newSource:void 0}:t?{newErrorValue:t,newSource:"field"}:{newErrorValue:void 0,newSource:void 0},pe=({formLevelError:r,fieldLevelError:i})=>i?{newErrorValue:i,newSource:"field"}:r?{newErrorValue:r,newSource:"form"}:{newErrorValue:void 0,newSource:void 0};function ze(r){const i=new Map;for(const t of r){const e=[...t.path??[]].map(s=>{const a=typeof s=="object"?s.key:s;return typeof a=="number"?`[${a}]`:a}).join(".").replace(/\.\[/g,"[");i.set(e,(i.get(e)??[]).concat(t))}return Object.fromEntries(i)}const Me=r=>{const i=ze(r);return{form:i,fields:i}},L={validate({value:r,validationSource:i},t){const e=t["~standard"].validate(r);if(e instanceof Promise)throw new Error("async function passed to sync validator");if(e.issues)return i==="field"?e.issues:Me(e.issues)},async validateAsync({value:r,validationSource:i},t){const e=await t["~standard"].validate(r);if(e.issues)return i==="field"?e.issues:Me(e.issues)}},Ee=r=>!!r&&"~standard"in r,Z={isValidating:!1,isTouched:!1,isBlurred:!1,isDirty:!1,isPristine:!0,isValid:!0,isDefaultValue:!0,errors:[],errorMap:{},errorSourceMap:{}};function K(r){function i(u,l,v,h){const m=e(u,l,v,h);({insert:()=>o(m,u,l),remove:()=>f(m),swap:()=>h!==void 0&&c(m,u,l,h),move:()=>h!==void 0&&d(m,u,l,h)})[v]()}function t(u,l){return`${u}[${l}]`}function e(u,l,v,h){const m=[t(u,l)];if(v==="swap")m.push(t(u,h));else if(v==="move"){const[M,p]=[Math.min(l,h),Math.max(l,h)];for(let g=M;g<=p;g++)m.push(t(u,g))}else{const M=r.getFieldValue(u),p=Array.isArray(M)?M.length:0;for(let g=l+1;g<p;g++)m.push(t(u,g))}return Object.keys(r.fieldInfo).filter(M=>m.some(p=>M.startsWith(p)))}function s(u,l){return u.replace(/\[(\d+)\]/,(v,h)=>{const m=parseInt(h,10);return`[${l==="up"?m+1:Math.max(0,m-1)}]`})}function a(u,l){(l==="up"?u:[...u].reverse()).forEach(h=>{const m=s(h.toString(),l),M=r.getFieldMeta(m);M?r.setFieldMeta(h,M):r.setFieldMeta(h,n())})}const n=()=>Z,o=(u,l,v)=>{a(u,"down"),u.forEach(h=>{h.toString().startsWith(t(l,v))&&r.setFieldMeta(h,n())})},f=u=>{a(u,"up")},d=(u,l,v,h)=>{const m=new Map(Object.keys(r.fieldInfo).filter(M=>M.startsWith(t(l,v))).map(M=>[M,r.getFieldMeta(M)]));a(u,v<h?"up":"down"),Object.keys(r.fieldInfo).filter(M=>M.startsWith(t(l,h))).forEach(M=>{const p=M.replace(t(l,h),t(l,v)),g=m.get(p);g&&r.setFieldMeta(M,g)})},c=(u,l,v,h)=>{u.forEach(m=>{if(!m.toString().startsWith(t(l,v)))return;const M=m.toString().replace(t(l,v),t(l,h)),[p,g]=[r.getFieldMeta(m),r.getFieldMeta(M)];p&&r.setFieldMeta(M,p),g&&r.setFieldMeta(m,g)})};return{handleArrayFieldMetaShift:i}}function ae(r){return{values:r.values??{},errorMap:r.errorMap??{},fieldMetaBase:r.fieldMetaBase??{},isSubmitted:r.isSubmitted??!1,isSubmitting:r.isSubmitting??!1,isValidating:r.isValidating??!1,submissionAttempts:r.submissionAttempts??0,isSubmitSuccessful:r.isSubmitSuccessful??!1,validationMetaMap:r.validationMetaMap??{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0}}}class Ue{constructor(i){var t;this.options={},this.fieldInfo={},this.prevTransformArray=[],this.mount=()=>{var e,s;const a=this.fieldMetaDerived.mount(),n=this.store.mount(),o=()=>{a(),n()};(s=(e=this.options.listeners)==null?void 0:e.onMount)==null||s.call(e,{formApi:this});const{onMount:f}=this.options.validators||{};return f&&this.validateSync("mount"),o},this.update=e=>{var s,a;if(!e)return;const n=this.options;this.options=e;const o=!!((a=(s=e.transform)==null?void 0:s.deps)!=null&&a.some((c,u)=>c!==this.prevTransformArray[u])),f=e.defaultValues&&!I(e.defaultValues,n.defaultValues)&&!this.state.isTouched,d=!I(e.defaultState,n.defaultState)&&!this.state.isTouched;!f&&!d&&!o||D(()=>{this.baseStore.setState(()=>ae(Object.assign({},this.state,d?e.defaultState:{},f?{values:e.defaultValues}:{},o?{_force_re_eval:!this.state._force_re_eval}:{})))})},this.reset=(e,s)=>{const{fieldMeta:a}=this.state,n=this.resetFieldMeta(a);e&&!(s!=null&&s.keepDefaultValues)&&(this.options={...this.options,defaultValues:e}),this.baseStore.setState(()=>{var o;return ae({...this.options.defaultState,values:e??this.options.defaultValues??((o=this.options.defaultState)==null?void 0:o.values),fieldMetaBase:n})})},this.validateAllFields=async e=>{const s=[];return D(()=>{Object.values(this.fieldInfo).forEach(n=>{if(!n.instance)return;const o=n.instance;s.push(Promise.resolve().then(()=>o.validate(e,{skipFormValidation:!0}))),n.instance.state.meta.isTouched||n.instance.setMeta(f=>({...f,isTouched:!0}))})}),(await Promise.all(s)).flat()},this.validateArrayFieldsStartingFrom=async(e,s,a)=>{const n=this.getFieldValue(e),o=Array.isArray(n)?Math.max(n.length-1,0):null,f=[`${e}[${s}]`];for(let l=s+1;l<=(o??0);l++)f.push(`${e}[${l}]`);const d=Object.keys(this.fieldInfo).filter(l=>f.some(v=>l.startsWith(v))),c=[];return D(()=>{d.forEach(l=>{c.push(Promise.resolve().then(()=>this.validateField(l,a)))})}),(await Promise.all(c)).flat()},this.validateField=(e,s)=>{var a;const n=(a=this.fieldInfo[e])==null?void 0:a.instance;return n?(n.state.meta.isTouched||n.setMeta(o=>({...o,isTouched:!0})),n.validate(s)):[]},this.validateSync=e=>{const s=ce(e,this.options);let a=!1;const n={};return D(()=>{var o,f;for(const c of s){if(!c.validate)continue;const u=this.runValidator({validate:c.validate,value:{value:this.state.values,formApi:this,validationSource:"form"},type:"validate"}),{formError:l,fieldErrors:v}=X(u),h=N(c.cause);for(const m of Object.keys(this.state.fieldMeta)){const M=this.getFieldMeta(m);if(!M)continue;const{errorMap:p,errorSourceMap:g}=M,y=v==null?void 0:v[m],{newErrorValue:V,newSource:F}=me({newFormValidatorError:y,isPreviousErrorFromFormValidator:(g==null?void 0:g[h])==="form",previousErrorValue:p==null?void 0:p[h]});F==="form"&&(n[m]={...n[m],[h]:y}),(p==null?void 0:p[h])!==V&&this.setFieldMeta(m,w=>({...w,errorMap:{...w.errorMap,[h]:V},errorSourceMap:{...w.errorSourceMap,[h]:F}}))}((o=this.state.errorMap)==null?void 0:o[h])!==l&&this.baseStore.setState(m=>({...m,errorMap:{...m.errorMap,[h]:l}})),(l||v)&&(a=!0)}const d=N("submit");(f=this.state.errorMap)!=null&&f[d]&&e!=="submit"&&!a&&this.baseStore.setState(c=>({...c,errorMap:{...c.errorMap,[d]:void 0}}))}),{hasErrored:a,fieldsErrorMap:n}},this.validateAsync=async e=>{const s=ue(e,this.options);this.state.isFormValidating||this.baseStore.setState(d=>({...d,isFormValidating:!0}));const a=[];let n;for(const d of s){if(!d.validate)continue;const c=N(d.cause),u=this.state.validationMetaMap[c];u==null||u.lastAbortController.abort();const l=new AbortController;this.state.validationMetaMap[c]={lastAbortController:l},a.push(new Promise(async v=>{let h;try{h=await new Promise((g,y)=>{setTimeout(async()=>{if(l.signal.aborted)return g(void 0);try{g(await this.runValidator({validate:d.validate,value:{value:this.state.values,formApi:this,validationSource:"form",signal:l.signal},type:"validateAsync"}))}catch(V){y(V)}},d.debounceMs)})}catch(g){h=g}const{formError:m,fieldErrors:M}=X(h);M&&(n=n?{...n,...M}:M);const p=N(d.cause);for(const g of Object.keys(this.state.fieldMeta)){const y=this.getFieldMeta(g);if(!y)continue;const{errorMap:V,errorSourceMap:F}=y,w=n==null?void 0:n[g],{newErrorValue:_,newSource:k}=me({newFormValidatorError:w,isPreviousErrorFromFormValidator:(F==null?void 0:F[p])==="form",previousErrorValue:V==null?void 0:V[p]});(V==null?void 0:V[p])!==_&&this.setFieldMeta(g,b=>({...b,errorMap:{...b.errorMap,[p]:_},errorSourceMap:{...b.errorSourceMap,[p]:k}}))}this.baseStore.setState(g=>({...g,errorMap:{...g.errorMap,[p]:m}})),v(n?{fieldErrors:n,errorMapKey:p}:void 0)}))}let o=[];const f={};if(a.length){o=await Promise.all(a);for(const d of o)if(d!=null&&d.fieldErrors){const{errorMapKey:c}=d;for(const[u,l]of Object.entries(d.fieldErrors)){const h={...f[u]||{},[c]:l};f[u]=h}}}return this.baseStore.setState(d=>({...d,isFormValidating:!1})),f},this.validate=e=>{const{hasErrored:s,fieldsErrorMap:a}=this.validateSync(e);return s&&!this.options.asyncAlways?a:this.validateAsync(e)},this.getFieldValue=e=>W(this.state.values,e),this.getFieldMeta=e=>this.state.fieldMeta[e],this.getFieldInfo=e=>{var s;return(s=this.fieldInfo)[e]||(s[e]={instance:null,validationMetaMap:{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0}})},this.setFieldMeta=(e,s)=>{this.baseStore.setState(a=>({...a,fieldMetaBase:{...a.fieldMetaBase,[e]:ee(s,a.fieldMetaBase[e])}}))},this.resetFieldMeta=e=>Object.keys(e).reduce((s,a)=>{const n=a;return s[n]=Z,s},{}),this.setFieldValue=(e,s,a)=>{const n=(a==null?void 0:a.dontUpdateMeta)??!1;D(()=>{n||this.setFieldMeta(e,o=>({...o,isTouched:!0,isDirty:!0,errorMap:{...o==null?void 0:o.errorMap,onMount:void 0}})),this.baseStore.setState(o=>({...o,values:U(o.values,e,s)}))})},this.deleteField=e=>{const a=[...Object.keys(this.fieldInfo).filter(n=>{const o=e.toString();return n!==o&&n.startsWith(o)}),e];this.baseStore.setState(n=>{const o={...n};return a.forEach(f=>{o.values=$e(o.values,f),delete this.fieldInfo[f],delete o.fieldMetaBase[f]}),o})},this.pushFieldValue=(e,s,a)=>{this.setFieldValue(e,n=>[...Array.isArray(n)?n:[],s],a),this.validateField(e,"change")},this.insertFieldValue=async(e,s,a,n)=>{this.setFieldValue(e,o=>[...o.slice(0,s),a,...o.slice(s)],n),await this.validateField(e,"change"),K(this).handleArrayFieldMetaShift(e,s,"insert"),await this.validateArrayFieldsStartingFrom(e,s,"change")},this.replaceFieldValue=async(e,s,a,n)=>{this.setFieldValue(e,o=>o.map((f,d)=>d===s?a:f),n),await this.validateField(e,"change"),await this.validateArrayFieldsStartingFrom(e,s,"change")},this.removeFieldValue=async(e,s,a)=>{const n=this.getFieldValue(e),o=Array.isArray(n)?Math.max(n.length-1,0):null;if(this.setFieldValue(e,f=>f.filter((d,c)=>c!==s),a),K(this).handleArrayFieldMetaShift(e,s,"remove"),o!==null){const f=`${e}[${o}]`;this.deleteField(f)}await this.validateField(e,"change"),await this.validateArrayFieldsStartingFrom(e,s,"change")},this.swapFieldValues=(e,s,a,n)=>{this.setFieldValue(e,o=>{const f=o[s],d=o[a];return U(U(o,`${s}`,d),`${a}`,f)},n),K(this).handleArrayFieldMetaShift(e,s,"swap",a),this.validateField(e,"change"),this.validateField(`${e}[${s}]`,"change"),this.validateField(`${e}[${a}]`,"change")},this.moveFieldValues=(e,s,a,n)=>{this.setFieldValue(e,o=>(o.splice(a,0,o.splice(s,1)[0]),o),n),K(this).handleArrayFieldMetaShift(e,s,"move",a),this.validateField(e,"change"),this.validateField(`${e}[${s}]`,"change"),this.validateField(`${e}[${a}]`,"change")},this.clearFieldValues=(e,s)=>{const a=this.getFieldValue(e),n=Array.isArray(a)?Math.max(a.length-1,0):null;if(this.setFieldValue(e,[],s),n!==null)for(let o=0;o<=n;o++){const f=`${e}[${o}]`;this.deleteField(f)}this.validateField(e,"change")},this.resetField=e=>{this.baseStore.setState(s=>({...s,fieldMetaBase:{...s.fieldMetaBase,[e]:Z},values:this.options.defaultValues?U(s.values,e,W(this.options.defaultValues,e)):s.values}))},this.getAllErrors=()=>({form:{errors:this.state.errors,errorMap:this.state.errorMap},fields:Object.entries(this.state.fieldMeta).reduce((e,[s,a])=>(Object.keys(a).length&&a.errors.length&&(e[s]={errors:a.errors,errorMap:a.errorMap}),e),{})}),this.parseValuesWithSchema=e=>L.validate({value:this.state.values,validationSource:"form"},e),this.parseValuesWithSchemaAsync=e=>L.validateAsync({value:this.state.values,validationSource:"form"},e),this.baseStore=new oe(ae({...i==null?void 0:i.defaultState,values:(i==null?void 0:i.defaultValues)??((t=i==null?void 0:i.defaultState)==null?void 0:t.values)})),this.fieldMetaDerived=new O({deps:[this.baseStore],fn:({prevDepVals:e,currDepVals:s,prevVal:a})=>{var n,o,f;const d=a,c=e==null?void 0:e[0],u=s[0];let l=0;const v={};for(const h of Object.keys(u.fieldMetaBase)){const m=u.fieldMetaBase[h],M=c==null?void 0:c.fieldMetaBase[h],p=d==null?void 0:d[h],g=W(u.values,h);let y=p==null?void 0:p.errors;if(!M||m.errorMap!==M.errorMap){y=Object.values(m.errorMap??{}).filter(k=>k!==void 0);const _=(n=this.getFieldInfo(h))==null?void 0:n.instance;_&&!_.options.disableErrorFlat&&(y=y==null?void 0:y.flat(1))}const V=!Re(y??[]),F=!m.isDirty,w=I(g,W(this.options.defaultValues,h))||I(g,(f=(o=this.getFieldInfo(h))==null?void 0:o.instance)==null?void 0:f.options.defaultValue);if(p&&p.isPristine===F&&p.isValid===V&&p.isDefaultValue===w&&p.errors===y&&m===M){v[h]=p,l++;continue}v[h]={...m,errors:y,isPristine:F,isValid:V,isDefaultValue:w}}return Object.keys(u.fieldMetaBase).length&&d&&l===Object.keys(u.fieldMetaBase).length?d:v}}),this.store=new O({deps:[this.baseStore,this.fieldMetaDerived],fn:({prevDepVals:e,currDepVals:s,prevVal:a})=>{var n,o,f,d;const c=a,u=e==null?void 0:e[0],l=s[0],v=s[1],h=Object.values(v).filter(Boolean),m=h.some(S=>S.isValidating),M=h.every(S=>S.isValid),p=h.some(S=>S.isTouched),g=h.some(S=>S.isBlurred),y=h.every(S=>S.isDefaultValue),V=p&&((n=l.errorMap)==null?void 0:n.onMount),F=h.some(S=>S.isDirty),w=!F,_=!!((o=l.errorMap)!=null&&o.onMount||h.some(S=>{var A;return(A=S==null?void 0:S.errorMap)==null?void 0:A.onMount})),k=!!m;let b=(c==null?void 0:c.errors)??[];(!u||l.errorMap!==u.errorMap)&&(b=Object.values(l.errorMap).reduce((S,A)=>A===void 0?S:A&&de(A)?(S.push(A.form),S):(S.push(A),S),[]));const P=b.length===0,B=M&&P,Te=this.options.canSubmitWhenInvalid??!1,ve=l.submissionAttempts===0&&!p&&!_||!k&&!l.isSubmitting&&B||Te;let R=l.errorMap;if(V&&(b=b.filter(S=>S!==l.errorMap.onMount),R=Object.assign(R,{onMount:void 0})),c&&u&&c.errorMap===R&&c.fieldMeta===this.fieldMetaDerived.state&&c.errors===b&&c.isFieldsValidating===m&&c.isFieldsValid===M&&c.isFormValid===P&&c.isValid===B&&c.canSubmit===ve&&c.isTouched===p&&c.isBlurred===g&&c.isPristine===w&&c.isDefaultValue===y&&c.isDirty===F&&I(u,l))return c;let se={...l,errorMap:R,fieldMeta:this.fieldMetaDerived.state,errors:b,isFieldsValidating:m,isFieldsValid:M,isFormValid:P,isValid:B,canSubmit:ve,isTouched:p,isBlurred:g,isPristine:w,isDefaultValue:y,isDirty:F};const ie=((f=this.options.transform)==null?void 0:f.deps)??[];if(ie.length!==this.prevTransformArray.length||ie.some((S,A)=>S!==this.prevTransformArray[A])){const S=Object.assign({},this,{state:se});(d=this.options.transform)==null||d.fn(S),se=S.state,this.prevTransformArray=ie}return se}}),this.handleSubmit=this.handleSubmit.bind(this),this.update(i||{})}get state(){return this.store.state}runValidator(i){return Ee(i.validate)?L[i.type](i.value,i.validate):i.validate(i.value)}async handleSubmit(i){var t,e,s,a,n,o,f,d;if(this.baseStore.setState(u=>({...u,isSubmitted:!1,submissionAttempts:u.submissionAttempts+1,isSubmitSuccessful:!1})),D(()=>{Object.values(this.fieldInfo).forEach(u=>{u.instance&&(u.instance.state.meta.isTouched||u.instance.setMeta(l=>({...l,isTouched:!0})))})}),!this.state.canSubmit)return;this.baseStore.setState(u=>({...u,isSubmitting:!0}));const c=()=>{this.baseStore.setState(u=>({...u,isSubmitting:!1}))};if(await this.validateAllFields("submit"),!this.state.isFieldsValid){c(),(e=(t=this.options).onSubmitInvalid)==null||e.call(t,{value:this.state.values,formApi:this});return}if(await this.validate("submit"),!this.state.isValid){c(),(a=(s=this.options).onSubmitInvalid)==null||a.call(s,{value:this.state.values,formApi:this});return}D(()=>{Object.values(this.fieldInfo).forEach(u=>{var l,v,h;(h=(v=(l=u.instance)==null?void 0:l.options.listeners)==null?void 0:v.onSubmit)==null||h.call(v,{value:u.instance.state.value,fieldApi:u.instance})})}),(o=(n=this.options.listeners)==null?void 0:n.onSubmit)==null||o.call(n,{formApi:this});try{await((d=(f=this.options).onSubmit)==null?void 0:d.call(f,{value:this.state.values,formApi:this,meta:i??this.options.onSubmitMeta})),D(()=>{this.baseStore.setState(u=>({...u,isSubmitted:!0,isSubmitSuccessful:!0})),c()})}catch(u){throw this.baseStore.setState(l=>({...l,isSubmitSuccessful:!1})),c(),u}}setErrorMap(i){D(()=>{Object.entries(i).forEach(([t,e])=>{const s=t;if(de(e)){const{formError:a,fieldErrors:n}=X(e);for(const o of Object.keys(this.fieldInfo))this.getFieldMeta(o)&&this.setFieldMeta(o,d=>({...d,errorMap:{...d.errorMap,[s]:n==null?void 0:n[o]},errorSourceMap:{...d.errorSourceMap,[s]:"form"}}));this.baseStore.setState(o=>({...o,errorMap:{...o.errorMap,[s]:a}}))}else this.baseStore.setState(a=>({...a,errorMap:{...a.errorMap,[s]:e}}))})})}}function X(r){if(r){if(de(r)){const i=X(r.form).formError,t=r.fields;return{formError:i,fieldErrors:t}}return{formError:r}}return{formError:void 0}}function N(r){switch(r){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"change":default:return"onChange"}}class Ge{constructor(i){this.options={},this.mount=()=>{var t,e;const s=this.store.mount();this.options.defaultValue!==void 0&&this.form.setFieldValue(this.name,this.options.defaultValue,{dontUpdateMeta:!0});const a=this.getInfo();a.instance=this,this.update(this.options);const{onMount:n}=this.options.validators||{};if(n){const o=this.runValidator({validate:n,value:{value:this.state.value,fieldApi:this,validationSource:"field"},type:"validate"});o&&this.setMeta(f=>({...f,errorMap:{...f==null?void 0:f.errorMap,onMount:o},errorSourceMap:{...f==null?void 0:f.errorSourceMap,onMount:"field"}}))}return(e=(t=this.options.listeners)==null?void 0:t.onMount)==null||e.call(t,{value:this.state.value,fieldApi:this}),s},this.update=t=>{this.options=t;const e=this.name!==t.name;if(this.name=t.name,this.state.value===void 0){const s=W(t.form.options.defaultValues,t.name),a=t.defaultValue??s;e?this.setValue(n=>n||a,{dontUpdateMeta:!0}):a!==void 0&&this.setValue(a,{dontUpdateMeta:!0})}this.form.getFieldMeta(this.name)===void 0&&this.setMeta(this.state.meta)},this.getValue=()=>this.form.getFieldValue(this.name),this.setValue=(t,e)=>{this.form.setFieldValue(this.name,t,e),this.triggerOnChangeListener(),this.validate("change")},this.getMeta=()=>this.store.state.meta,this.setMeta=t=>this.form.setFieldMeta(this.name,t),this.getInfo=()=>this.form.getFieldInfo(this.name),this.pushValue=(t,e)=>{this.form.pushFieldValue(this.name,t,e),this.triggerOnChangeListener()},this.insertValue=(t,e,s)=>{this.form.insertFieldValue(this.name,t,e,s),this.triggerOnChangeListener()},this.replaceValue=(t,e,s)=>{this.form.replaceFieldValue(this.name,t,e,s),this.triggerOnChangeListener()},this.removeValue=(t,e)=>{this.form.removeFieldValue(this.name,t,e),this.triggerOnChangeListener()},this.swapValues=(t,e,s)=>{this.form.swapFieldValues(this.name,t,e,s),this.triggerOnChangeListener()},this.moveValue=(t,e,s)=>{this.form.moveFieldValues(this.name,t,e,s),this.triggerOnChangeListener()},this.clearValues=t=>{this.form.clearFieldValues(this.name,t),this.triggerOnChangeListener()},this.getLinkedFields=t=>{const e=Object.values(this.form.fieldInfo),s=[];for(const a of e){if(!a.instance)continue;const{onChangeListenTo:n,onBlurListenTo:o}=a.instance.options.validators||{};t==="change"&&(n!=null&&n.includes(this.name))&&s.push(a.instance),t==="blur"&&(o!=null&&o.includes(this.name))&&s.push(a.instance)}return s},this.validateSync=(t,e)=>{var s;const a=ce(t,this.options),o=this.getLinkedFields(t).reduce((c,u)=>{const l=ce(t,u.options);return l.forEach(v=>{v.field=u}),c.concat(l)},[]);let f=!1;D(()=>{const c=(u,l)=>{var v;const h=H(l.cause),m=l.validate?ge(u.runValidator({validate:l.validate,value:{value:u.store.state.value,validationSource:"field",fieldApi:u},type:"validate"})):void 0,M=e[h],{newErrorValue:p,newSource:g}=pe({formLevelError:M,fieldLevelError:m});((v=u.state.meta.errorMap)==null?void 0:v[h])!==p&&u.setMeta(y=>({...y,errorMap:{...y.errorMap,[h]:p},errorSourceMap:{...y.errorSourceMap,[h]:g}})),p&&(f=!0)};for(const u of a)c(this,u);for(const u of o)u.validate&&c(u.field,u)});const d=H("submit");return(s=this.state.meta.errorMap)!=null&&s[d]&&t!=="submit"&&!f&&this.setMeta(c=>({...c,errorMap:{...c.errorMap,[d]:void 0},errorSourceMap:{...c.errorSourceMap,[d]:void 0}})),{hasErrored:f}},this.validateAsync=async(t,e)=>{const s=ue(t,this.options),a=await e,n=this.getLinkedFields(t),o=n.reduce((l,v)=>{const h=ue(t,v.options);return h.forEach(m=>{m.field=v}),l.concat(h)},[]);this.state.meta.isValidating||this.setMeta(l=>({...l,isValidating:!0}));for(const l of n)l.setMeta(v=>({...v,isValidating:!0}));const f=[],d=[],c=(l,v,h)=>{const m=H(v.cause),M=l.getInfo().validationMetaMap[m];M==null||M.lastAbortController.abort();const p=new AbortController;this.getInfo().validationMetaMap[m]={lastAbortController:p},h.push(new Promise(async g=>{var y;let V;try{V=await new Promise((b,P)=>{this.timeoutIds.validations[v.cause]&&clearTimeout(this.timeoutIds.validations[v.cause]),this.timeoutIds.validations[v.cause]=setTimeout(async()=>{if(p.signal.aborted)return b(void 0);try{b(await this.runValidator({validate:v.validate,value:{value:l.store.state.value,fieldApi:l,signal:p.signal,validationSource:"field"},type:"validateAsync"}))}catch(B){P(B)}},v.debounceMs)})}catch(b){V=b}if(p.signal.aborted)return g(void 0);const F=ge(V),w=(y=a[this.name])==null?void 0:y[m],{newErrorValue:_,newSource:k}=pe({formLevelError:w,fieldLevelError:F});l.setMeta(b=>({...b,errorMap:{...b==null?void 0:b.errorMap,[m]:_},errorSourceMap:{...b.errorSourceMap,[m]:k}})),g(_)}))};for(const l of s)l.validate&&c(this,l,f);for(const l of o)l.validate&&c(l.field,l,d);let u=[];(f.length||d.length)&&(u=await Promise.all(f),await Promise.all(d)),this.setMeta(l=>({...l,isValidating:!1}));for(const l of n)l.setMeta(v=>({...v,isValidating:!1}));return u.filter(Boolean)},this.validate=(t,e)=>{var s;if(!this.state.meta.isTouched)return[];const{fieldsErrorMap:a}=e!=null&&e.skipFormValidation?{fieldsErrorMap:{}}:this.form.validateSync(t),{hasErrored:n}=this.validateSync(t,a[this.name]??{});if(n&&!this.options.asyncAlways)return(s=this.getInfo().validationMetaMap[H(t)])==null||s.lastAbortController.abort(),this.state.meta.errors;const o=e!=null&&e.skipFormValidation?Promise.resolve({}):this.form.validateAsync(t);return this.validateAsync(t,o)},this.handleChange=t=>{this.setValue(t)},this.handleBlur=()=>{this.state.meta.isTouched||(this.setMeta(e=>({...e,isTouched:!0})),this.validate("change")),this.state.meta.isBlurred||this.setMeta(e=>({...e,isBlurred:!0})),this.validate("blur"),this.triggerOnBlurListener()},this.parseValueWithSchema=t=>L.validate({value:this.state.value,validationSource:"field"},t),this.parseValueWithSchemaAsync=t=>L.validateAsync({value:this.state.value,validationSource:"field"},t),this.form=i.form,this.name=i.name,this.timeoutIds={validations:{},listeners:{},formListeners:{}},this.store=new O({deps:[this.form.store],fn:()=>{const t=this.form.getFieldValue(this.name),e=this.form.getFieldMeta(this.name)??{...Z,...i.defaultMeta};return{value:t,meta:e}}}),this.options=i}get state(){return this.store.state}runValidator(i){return Ee(i.validate)?L[i.type](i.value,i.validate):i.validate(i.value)}setErrorMap(i){this.setMeta(t=>({...t,errorMap:{...t.errorMap,...i}}))}triggerOnBlurListener(){var i,t,e,s,a,n;const o=(i=this.form.options.listeners)==null?void 0:i.onBlurDebounceMs;o&&o>0?(this.timeoutIds.formListeners.blur&&clearTimeout(this.timeoutIds.formListeners.blur),this.timeoutIds.formListeners.blur=setTimeout(()=>{var d,c;(c=(d=this.form.options.listeners)==null?void 0:d.onBlur)==null||c.call(d,{formApi:this.form,fieldApi:this})},o)):(e=(t=this.form.options.listeners)==null?void 0:t.onBlur)==null||e.call(t,{formApi:this.form,fieldApi:this});const f=(s=this.options.listeners)==null?void 0:s.onBlurDebounceMs;f&&f>0?(this.timeoutIds.listeners.blur&&clearTimeout(this.timeoutIds.listeners.blur),this.timeoutIds.listeners.blur=setTimeout(()=>{var d,c;(c=(d=this.options.listeners)==null?void 0:d.onBlur)==null||c.call(d,{value:this.state.value,fieldApi:this})},f)):(n=(a=this.options.listeners)==null?void 0:a.onBlur)==null||n.call(a,{value:this.state.value,fieldApi:this})}triggerOnChangeListener(){var i,t,e,s,a,n;const o=(i=this.form.options.listeners)==null?void 0:i.onChangeDebounceMs;o&&o>0?(this.timeoutIds.formListeners.blur&&clearTimeout(this.timeoutIds.formListeners.blur),this.timeoutIds.formListeners.blur=setTimeout(()=>{var d,c;(c=(d=this.form.options.listeners)==null?void 0:d.onChange)==null||c.call(d,{formApi:this.form,fieldApi:this})},o)):(e=(t=this.form.options.listeners)==null?void 0:t.onChange)==null||e.call(t,{formApi:this.form,fieldApi:this});const f=(s=this.options.listeners)==null?void 0:s.onChangeDebounceMs;f&&f>0?(this.timeoutIds.listeners.change&&clearTimeout(this.timeoutIds.listeners.change),this.timeoutIds.listeners.change=setTimeout(()=>{var d,c;(c=(d=this.options.listeners)==null?void 0:d.onChange)==null||c.call(d,{value:this.state.value,fieldApi:this})},f)):(n=(a=this.options.listeners)==null?void 0:a.onChange)==null||n.call(a,{value:this.state.value,fieldApi:this})}}function ge(r){if(r)return r}function H(r){switch(r){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"change":default:return"onChange"}}var _e={exports:{}},Ae={},De={exports:{}},Oe={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $=T;function Ke(r,i){return r===i&&(r!==0||1/r===1/i)||r!==r&&i!==i}var Ne=typeof Object.is=="function"?Object.is:Ke,He=$.useState,Je=$.useEffect,Qe=$.useLayoutEffect,Xe=$.useDebugValue;function Ye(r,i){var t=i(),e=He({inst:{value:t,getSnapshot:i}}),s=e[0].inst,a=e[1];return Qe(function(){s.value=t,s.getSnapshot=i,ne(s)&&a({inst:s})},[r,t,i]),Je(function(){return ne(s)&&a({inst:s}),r(function(){ne(s)&&a({inst:s})})},[r]),Xe(t),t}function ne(r){var i=r.getSnapshot;r=r.value;try{var t=i();return!Ne(r,t)}catch{return!0}}function Ze(r,i){return i()}var qe=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Ze:Ye;Oe.useSyncExternalStore=$.useSyncExternalStore!==void 0?$.useSyncExternalStore:qe;De.exports=Oe;var et=De.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var te=T,tt=et;function st(r,i){return r===i&&(r!==0||1/r===1/i)||r!==r&&i!==i}var it=typeof Object.is=="function"?Object.is:st,rt=tt.useSyncExternalStore,at=te.useRef,nt=te.useEffect,ot=te.useMemo,lt=te.useDebugValue;Ae.useSyncExternalStoreWithSelector=function(r,i,t,e,s){var a=at(null);if(a.current===null){var n={hasValue:!1,value:null};a.current=n}else n=a.current;a=ot(function(){function f(v){if(!d){if(d=!0,c=v,v=e(v),s!==void 0&&n.hasValue){var h=n.value;if(s(h,v))return u=h}return u=v}if(h=u,it(c,v))return h;var m=e(v);return s!==void 0&&s(h,m)?(c=v,h):(c=v,u=m)}var d=!1,c,u,l=t===void 0?null:t;return[function(){return f(i())},l===null?void 0:function(){return f(l())}]},[i,t,e,s]);var o=rt(r,a[0],a[1]);return nt(function(){n.hasValue=!0,n.value=o},[o]),lt(o),o};_e.exports=Ae;var ut=_e.exports;function fe(r,i=t=>t){return ut.useSyncExternalStoreWithSelector(r.subscribe,()=>r.state,()=>r.state,i,ct)}function ct(r,i){if(Object.is(r,i))return!0;if(typeof r!="object"||r===null||typeof i!="object"||i===null)return!1;if(r instanceof Map&&i instanceof Map){if(r.size!==i.size)return!1;for(const[e,s]of r)if(!i.has(e)||!Object.is(s,i.get(e)))return!1;return!0}if(r instanceof Set&&i instanceof Set){if(r.size!==i.size)return!1;for(const e of r)if(!i.has(e))return!1;return!0}const t=Object.keys(r);if(t.length!==Object.keys(i).length)return!1;for(let e=0;e<t.length;e++)if(!Object.prototype.hasOwnProperty.call(i,t[e])||!Object.is(r[t[e]],i[t[e]]))return!1;return!0}const q=typeof window<"u"?T.useLayoutEffect:T.useEffect;function dt(r){const[i]=T.useState(()=>{const e=new Ge({...r,form:r.form,name:r.name});return e.Field=ke,e});return q(i.mount,[i]),q(()=>{i.update(r)}),fe(i.store,r.mode==="array"?t=>[t.meta,Object.keys(t.value??[]).length]:void 0),i}const ke=({children:r,...i})=>{const t=dt(i),e=T.useMemo(()=>ee(r,t),[r,t,t.state.value,t.state.meta]);return E.jsx(E.Fragment,{children:e})};function ht({form:r,selector:i,children:t}){const e=fe(r.store,i);return ee(t,e)}function ft(r){const[i]=T.useState(()=>{const t=new Ue(r),e=t;return e.Field=function(a){return E.jsx(ke,{...a,form:t})},e.Subscribe=s=>E.jsx(ht,{form:t,selector:s.selector,children:s.children}),e});return q(i.mount,[]),fe(i.store,t=>t.isSubmitting),q(()=>{i.update(r)}),i}const St={component:Ve},vt={width:"600px",height:"400px"},J={name:"With Tanstack Form",render:()=>{const r=ft({defaultValues:{text:"Hello tanstack"},onSubmit:i=>alert(JSON.stringify(i.value))});return E.jsxs("form",{onSubmit:i=>{i.preventDefault(),i.stopPropagation(),r.handleSubmit()},children:[E.jsx(r.Field,{name:"text",validators:{onChange:({value:i})=>{if(!i)return"This field is required";if(!i.toLowerCase().includes("tanstack"))return"Text must include tanstack"}},children:i=>E.jsxs(E.Fragment,{children:[E.jsx(Ve,{style:vt,name:i.name,value:i.state.value,onChange:t=>i.handleChange(t.target.value),onBlur:i.handleBlur,children:t=>t.split("").map((e,s)=>E.jsx("span",{style:{color:"tanstack".includes(e.toLowerCase())?"tan":void 0},children:e},s))}),i.state.meta.errors&&E.jsx("span",{style:{color:"red"},children:i.state.meta.errors.join(", ")})]})}),E.jsx("button",{type:"submit",children:"submit"})]})}};var Se,ye,be;J.parameters={...J.parameters,docs:{...(Se=J.parameters)==null?void 0:Se.docs,source:{originalSource:`{
  name: "With Tanstack Form",
  render: () => {
    const form = useForm({
      defaultValues: {
        text: "Hello tanstack"
      },
      onSubmit: data => alert(JSON.stringify(data.value))
    });
    return <form onSubmit={e => {
      e.preventDefault();
      e.stopPropagation();
      form.handleSubmit();
    }}>
        <form.Field name="text" validators={{
        onChange: ({
          value
        }) => {
          if (!value) {
            return "This field is required";
          }
          if (!value.toLowerCase().includes("tanstack")) {
            return "Text must include tanstack";
          }
        }
      }}>
          {field => <>
              <RichTextarea style={style} name={field.name} value={field.state.value} onChange={e => field.handleChange(e.target.value)} onBlur={field.handleBlur}>
                {v => {
              return v.split("").map((t, i) => <span key={i} style={{
                color: "tanstack".includes(t.toLowerCase()) ? "tan" : undefined
              }}>
                      {t}
                    </span>);
            }}
              </RichTextarea>
              {field.state.meta.errors && <span style={{
            color: "red"
          }}>
                  {field.state.meta.errors.join(", ")}
                </span>}
            </>}
        </form.Field>
        <button type="submit">submit</button>
      </form>;
  }
}`,...(be=(ye=J.parameters)==null?void 0:ye.docs)==null?void 0:be.source}}};const yt=["Default"];export{J as Default,yt as __namedExportsOrder,St as default};
